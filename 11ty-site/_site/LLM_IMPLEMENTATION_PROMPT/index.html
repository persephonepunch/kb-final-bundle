<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LLM Implementation Prompt | Webflow Integration KB</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">
</head>
<body>
  <header class="header">
  <div class="container">
    <div class="header-inner">
      <div class="header-left">
        <a href="/" class="logo">
          <div class="logo-icon">KB</div>
          <span class="logo-text">Integration Docs</span>
        </a>

        <nav class="nav-desktop">
          <a href="/" class="nav-link ">
            Overview
          </a>
          <a href="/architecture/" class="nav-link ">
            Architecture
          </a>
          <a href="/implementation/" class="nav-link ">
            Implementation
          </a>
          <a href="/eleventy-graphql/" class="nav-link ">
            11ty GraphQL
          </a>
          <a href="/webflow-sync/" class="nav-link ">
            Webflow Sync
          </a>
          <a href="/prd/" class="nav-link ">
            Claude PRD
          </a>
          <a href="/flow-chart/" class="nav-link ">
            Flow Charts
          </a>
        </nav>
      </div>

      <div class="header-right">
        <div class="search-container">
          <input type="text" id="searchInput" class="search-input" placeholder="Search documentation...">
        </div>

        <button class="mobile-menu-toggle" id="mobileMenuToggle">
          <span class="hamburger"></span>
        </button>
      </div>
    </div>

    <nav class="nav-mobile" id="mobileNav">
      <a href="/" class="nav-link-mobile">
        Overview
      </a>
      <a href="/architecture/" class="nav-link-mobile">
        Architecture
      </a>
      <a href="/implementation/" class="nav-link-mobile">
        Implementation
      </a>
      <a href="/eleventy-graphql/" class="nav-link-mobile">
        11ty GraphQL
      </a>
      <a href="/webflow-sync/" class="nav-link-mobile">
        Webflow Sync
      </a>
      <a href="/prd/" class="nav-link-mobile">
        Claude PRD
      </a>
      <a href="/flow-chart/" class="nav-link-mobile">
        Flow Charts
      </a>
    </nav>
  </div>
</header>

  
  <main class="main-content">
    <div class="container">
      <h1>LLM Implementation Prompt: 11ty + Shopify UCP + Google AI Integration</h1>
<h2>Overview</h2>
<p>This document provides a complete, step-by-step implementation prompt for Large Language Models (Claude, GPT-4, etc.) to build an Eleventy (11ty) static site with Shopify Universal Commerce Protocol (UCP) integration, OAuth 2.0 authentication, A2P payment processing, and Google AI data streaming.</p>
<p><strong>Architecture:</strong></p>
<ul>
<li><strong>Webflow</strong> = Design Module only (visual design tool, no runtime responsibility)</li>
<li><strong>CI/CD Pipeline</strong> = Publishes Webflow design components to dual targets</li>
<li><strong>11ty</strong> = Static site templates with GraphQL data mapping from Shopify</li>
<li><strong>Shopify Native</strong> = Mirror of synced front end (fallback and parity)</li>
</ul>
<hr>
<h2>Prompt for LLM</h2>
<pre><code>You are tasked with building a complete e-commerce static site system with the following architecture:

- **Webflow** serves as a Design Module only - for visual component design
- **CI/CD Pipeline** publishes Webflow designs to both 11ty and Shopify Native
- **11ty** generates static pages with GraphQL data from Shopify
- **Shopify Native** mirrors the front end for fallback/parity

Follow these instructions carefully to implement each component.

## PROJECT REQUIREMENTS

Build a dual-target e-commerce system with the following features:

1. **Webflow Design Module**: Visual design only, no runtime logic
2. **CI/CD Design Publish Pipeline**: Transforms Webflow exports to 11ty + Shopify Native
3. **Static Site Generation**: Use Eleventy (11ty) v3.x with Nunjucks templates
4. **Shopify Native Mirror**: Liquid templates matching 11ty output
5. **Product Catalog**: Fetch products from Shopify's UCP Catalog API via GraphQL
6. **User Authentication**: Implement OAuth 2.0 with PKCE for secure login
7. **Payment Processing**: Use Agent Payments Protocol (A2P) for cryptographic payment mandates
8. **Real-time Data**: Stream user behavior to Google AI via WebSocket
9. **Consent Management**: GDPR-compliant user consent tracking

## TECHNICAL STACK

- **Design**: Webflow Design Module (design-time only)
- **CI/CD**: GitHub Actions, design transformation scripts
- **Frontend**: Eleventy 11ty, Nunjucks, Shopify Liquid, Vanilla JavaScript (ES6+), CSS3
- **APIs**: Shopify UCP Catalog GraphQL API, OAuth 2.0, A2P Payment Gateway, Google AI Data Stream
- **Data Flow**: GraphQL, REST APIs, WebSocket, Server-Sent Events
- **Security**: JWT tokens, TLS 1.3, PKCE, PCI DSS compliance

## IMPLEMENTATION STEPS

### STEP 0: CI/CD Design Publish Pipeline

Set up the GitHub Actions workflow that publishes Webflow design components to both 11ty and Shopify Native.

**Create `.github/workflows/design-publish.yml`:**
```yaml
name: Design Component Publish

on:
  repository_dispatch:
    types: [webflow-design-update]
  workflow_dispatch:
    inputs:
      target:
        description: 'Target to publish (all, 11ty, shopify)'
        default: 'all'

jobs:
  export-design:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Export Webflow Design Tokens
        run: node scripts/export-webflow-design.js
        env:
          WEBFLOW_API_TOKEN: ${{ secrets.WEBFLOW_API_TOKEN }}
          WEBFLOW_SITE_ID: ${{ secrets.WEBFLOW_SITE_ID }}

      - name: Transform to 11ty Templates
        if: github.event.inputs.target == 'all' || github.event.inputs.target == '11ty'
        run: node scripts/transform-to-nunjucks.js

      - name: Transform to Shopify Liquid
        if: github.event.inputs.target == 'all' || github.event.inputs.target == 'shopify'
        run: node scripts/transform-to-liquid.js

      - name: Build 11ty Site
        if: github.event.inputs.target == 'all' || github.event.inputs.target == '11ty'
        run: npm run build

      - name: Deploy to Netlify
        if: github.event.inputs.target == 'all' || github.event.inputs.target == '11ty'
        run: netlify deploy --prod --dir=_site
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}

      - name: Sync to Shopify Theme
        if: github.event.inputs.target == 'all' || github.event.inputs.target == 'shopify'
        run: node scripts/sync-shopify-theme.js
        env:
          SHOPIFY_STORE_DOMAIN: ${{ secrets.SHOPIFY_STORE_DOMAIN }}
          SHOPIFY_ADMIN_ACCESS_TOKEN: ${{ secrets.SHOPIFY_ADMIN_ACCESS_TOKEN }}
          SHOPIFY_THEME_ID: ${{ secrets.SHOPIFY_THEME_ID }}
</code></pre>
<p><strong>Create <code>scripts/export-webflow-design.js</code>:</strong></p>
<pre><code class="language-javascript">/**
 * Export Webflow design tokens and component structure
 * This extracts CSS variables, typography, and component HTML
 */
const fs = require('fs').promises;

async function exportWebflowDesign() {
  // Extract design tokens from Webflow
  const designTokens = {
    colors: {
      primary: '#000000',
      accent: '#dc2626',
      text: '#1f2937',
      background: '#ffffff',
      border: '#e5e7eb',
    },
    typography: {
      fontFamily: &quot;'IBM Plex Sans', sans-serif&quot;,
      fontSizes: {
        xs: '0.75rem',
        sm: '0.875rem',
        base: '1rem',
        lg: '1.125rem',
        xl: '1.25rem',
        '2xl': '1.5rem',
        '3xl': '1.875rem',
      },
    },
    spacing: {
      unit: '8px',
      xs: '4px',
      sm: '8px',
      md: '16px',
      lg: '24px',
      xl: '32px',
    },
  };

  // Write design tokens for both targets
  await fs.writeFile(
    'src/_data/designTokens.json',
    JSON.stringify(designTokens, null, 2)
  );

  console.log('Design tokens exported successfully');
}

exportWebflowDesign();
</code></pre>
<p><strong>Create <code>scripts/transform-to-liquid.js</code>:</strong></p>
<pre><code class="language-javascript">/**
 * Transform 11ty Nunjucks templates to Shopify Liquid
 * Maintains parity between 11ty and Shopify Native
 */
const fs = require('fs').promises;
const path = require('path');

const nunjucksToLiquid = {
  '{% include': '{% include',
  '{% for ': '{% for ',
  '{% endfor %}': '{% endfor %}',
  '{% if ': '{% if ',
  '{% endif %}': '{% endif %}',
  '{{ ': '{{ ',
  ' }}': ' }}',
  '.njk': '.liquid',
};

async function transformToLiquid() {
  const templatesDir = 'src/_includes';
  const outputDir = 'shopify-theme/snippets';

  await fs.mkdir(outputDir, { recursive: true });

  // Transform component templates
  const components = await fs.readdir(path.join(templatesDir, 'components'));

  for (const file of components) {
    if (file.endsWith('.njk')) {
      let content = await fs.readFile(
        path.join(templatesDir, 'components', file),
        'utf-8'
      );

      // Basic Nunjucks to Liquid conversion
      // Note: Complex logic may need manual adjustment
      content = content
        .replace(/\{\% include &quot;components\//g, '{% include &quot;')
        .replace(/\.njk&quot; \%\}/g, '&quot; %}');

      const liquidFile = file.replace('.njk', '.liquid');
      await fs.writeFile(path.join(outputDir, liquidFile), content);
      console.log(`Transformed: ${file} → ${liquidFile}`);
    }
  }

  console.log('Shopify Liquid templates generated');
}

transformToLiquid();
</code></pre>
<h3>STEP 1: Initialize 11ty Project</h3>
<p>Create a new 11ty project with the following structure:</p>
<pre><code>project-root/
├── .eleventy.js           # 11ty configuration
├── package.json           # Dependencies
├── .env.example           # Environment variables template
├── src/
│   ├── _data/             # Data files for build-time fetching
│   │   ├── ucpClient.js   # UCP API client
│   │   └── products.js    # Product data fetcher
│   ├── _includes/
│   │   ├── layouts/
│   │   │   └── base.njk   # Base layout template
│   │   └── components/
│   │       ├── header.njk
│   │       ├── footer.njk
│   │       └── product-card.njk
│   ├── css/
│   │   └── main.css       # Vanilla CSS with BEM
│   ├── js/
│   │   ├── auth.js        # OAuth 2.0 client
│   │   ├── payment.js     # A2P payment handler
│   │   ├── websocket.js   # WebSocket client
│   │   └── main.js        # Main application logic
│   ├── index.njk          # Homepage
│   ├── products.njk       # Product listing page
│   └── checkout.njk       # Checkout page
└── _site/                 # Generated static site (output)
</code></pre>
<p><strong>package.json dependencies:</strong></p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;11ty-ucp-integration&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;eleventy --serve&quot;,
    &quot;build&quot;: &quot;eleventy&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@11ty/eleventy&quot;: &quot;^3.0.0&quot;,
    &quot;node-fetch&quot;: &quot;^3.3.0&quot;,
    &quot;dotenv&quot;: &quot;^16.0.0&quot;
  }
}
</code></pre>
<p><strong>.eleventy.js configuration:</strong></p>
<pre><code class="language-javascript">module.exports = function(eleventyConfig) {
  // Copy static assets
  eleventyConfig.addPassthroughCopy(&quot;src/css&quot;);
  eleventyConfig.addPassthroughCopy(&quot;src/js&quot;);
  
  // Set directories
  return {
    dir: {
      input: &quot;src&quot;,
      output: &quot;_site&quot;,
      includes: &quot;_includes&quot;,
      data: &quot;_data&quot;
    }
  };
};
</code></pre>
<h3>STEP 2: Implement UCP Catalog Integration</h3>
<p>Create a client to fetch products from Shopify's UCP Catalog API at build time.</p>
<p><strong>src/_data/ucpClient.js:</strong></p>
<pre><code class="language-javascript">import fetch from 'node-fetch';

class UCPClient {
  constructor() {
    this.baseURL = process.env.UCP_CATALOG_API_URL;
    this.clientId = process.env.UCP_CLIENT_ID;
    this.clientSecret = process.env.UCP_CLIENT_SECRET;
    this.token = null;
  }

  async authenticate() {
    // Generate JWT token for API authentication
    const response = await fetch(`${this.baseURL}/auth/token`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        client_id: this.clientId,
        client_secret: this.clientSecret,
        grant_type: 'client_credentials'
      })
    });
    
    const data = await response.json();
    this.token = data.access_token;
  }

  async fetchProducts() {
    if (!this.token) await this.authenticate();
    
    const response = await fetch(`${this.baseURL}/catalog/products`, {
      headers: {
        'Authorization': `Bearer ${this.token}`,
        'Content-Type': 'application/json'
      }
    });
    
    return await response.json();
  }
}

module.exports = new UCPClient();
</code></pre>
<p><strong>src/_data/products.js:</strong></p>
<pre><code class="language-javascript">const ucpClient = require('./ucpClient');

module.exports = async function() {
  try {
    const data = await ucpClient.fetchProducts();
    return data.products || [];
  } catch (error) {
    console.error('Failed to fetch products:', error);
    return []; // Return empty array as fallback
  }
};
</code></pre>
<h3>STEP 3: Create Templates</h3>
<p><strong>src/_includes/layouts/base.njk:</strong></p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;title&gt;{{ title | default(&quot;E-Commerce Store&quot;) }}&lt;/title&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/main.css&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
  {% include &quot;components/header.njk&quot; %}
  
  &lt;main&gt;
    {{ content | safe }}
  &lt;/main&gt;
  
  {% include &quot;components/footer.njk&quot; %}
  
  &lt;script src=&quot;/js/auth.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;/js/payment.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;/js/websocket.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;/js/main.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><strong>src/index.njk:</strong></p>
<pre><code class="language-html">---
layout: layouts/base.njk
title: &quot;Home - E-Commerce Store&quot;
---

&lt;section class=&quot;hero&quot;&gt;
  &lt;div class=&quot;container&quot;&gt;
    &lt;h1&gt;Welcome to Our Store&lt;/h1&gt;
    &lt;p&gt;Discover amazing products powered by Universal Commerce Protocol&lt;/p&gt;
  &lt;/div&gt;
&lt;/section&gt;

&lt;section class=&quot;products&quot;&gt;
  &lt;div class=&quot;container&quot;&gt;
    &lt;h2&gt;Featured Products&lt;/h2&gt;
    &lt;div class=&quot;product-grid&quot;&gt;
      {% for product in products %}
        {% include &quot;components/product-card.njk&quot; %}
      {% endfor %}
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/section&gt;
</code></pre>
<p><strong>src/_includes/components/product-card.njk:</strong></p>
<pre><code class="language-html">&lt;article class=&quot;product-card&quot;&gt;
  &lt;img src=&quot;{{ product.image }}&quot; alt=&quot;{{ product.name }}&quot; class=&quot;product-card__image&quot;&gt;
  &lt;div class=&quot;product-card__content&quot;&gt;
    &lt;h3 class=&quot;product-card__title&quot;&gt;{{ product.name }}&lt;/h3&gt;
    &lt;p class=&quot;product-card__description&quot;&gt;{{ product.description }}&lt;/p&gt;
    &lt;div class=&quot;product-card__footer&quot;&gt;
      &lt;span class=&quot;product-card__price&quot;&gt;${{ product.price }}&lt;/span&gt;
      &lt;button class=&quot;btn btn--primary&quot; data-product-id=&quot;{{ product.id }}&quot;&gt;
        Add to Cart
      &lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/article&gt;
</code></pre>
<h3>STEP 4: Implement OAuth 2.0 Authentication</h3>
<p><strong>src/js/auth.js:</strong></p>
<pre><code class="language-javascript">class AuthManager {
  constructor() {
    this.authEndpoint = 'https://identity-provider.example.com/authorize';
    this.tokenEndpoint = 'https://identity-provider.example.com/token';
    this.clientId = 'your-client-id';
    this.redirectUri = window.location.origin + '/callback';
  }

  // Generate PKCE code verifier and challenge
  async generatePKCE() {
    const verifier = this.generateRandomString(128);
    const challenge = await this.sha256(verifier);
    return { verifier, challenge };
  }

  generateRandomString(length) {
    const array = new Uint8Array(length);
    crypto.getRandomValues(array);
    return Array.from(array, byte =&gt; byte.toString(16).padStart(2, '0')).join('');
  }

  async sha256(plain) {
    const encoder = new TextEncoder();
    const data = encoder.encode(plain);
    const hash = await crypto.subtle.digest('SHA-256', data);
    return btoa(String.fromCharCode(...new Uint8Array(hash)))
      .replace(/\+/g, '-')
      .replace(/\//g, '_')
      .replace(/=/g, '');
  }

  // Initiate OAuth 2.0 login flow
  async login() {
    const { verifier, challenge } = await this.generatePKCE();
    
    // Store verifier for later use
    sessionStorage.setItem('pkce_verifier', verifier);
    
    // Build authorization URL
    const params = new URLSearchParams({
      response_type: 'code',
      client_id: this.clientId,
      redirect_uri: this.redirectUri,
      scope: 'openid profile email',
      code_challenge: challenge,
      code_challenge_method: 'S256'
    });
    
    // Redirect to authorization endpoint
    window.location.href = `${this.authEndpoint}?${params.toString()}`;
  }

  // Handle OAuth callback
  async handleCallback() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    
    if (!code) {
      console.error('No authorization code received');
      return;
    }
    
    const verifier = sessionStorage.getItem('pkce_verifier');
    
    // Exchange code for tokens
    const response = await fetch(this.tokenEndpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({
        grant_type: 'authorization_code',
        code: code,
        redirect_uri: this.redirectUri,
        client_id: this.clientId,
        code_verifier: verifier
      })
    });
    
    const tokens = await response.json();
    
    // Store tokens securely
    this.storeTokens(tokens);
    
    // Clean up
    sessionStorage.removeItem('pkce_verifier');
    
    // Redirect to home
    window.location.href = '/';
  }

  storeTokens(tokens) {
    // In production, use httpOnly cookies via backend
    localStorage.setItem('access_token', tokens.access_token);
    localStorage.setItem('id_token', tokens.id_token);
    if (tokens.refresh_token) {
      localStorage.setItem('refresh_token', tokens.refresh_token);
    }
  }

  getAccessToken() {
    return localStorage.getItem('access_token');
  }

  isAuthenticated() {
    return !!this.getAccessToken();
  }

  logout() {
    localStorage.removeItem('access_token');
    localStorage.removeItem('id_token');
    localStorage.removeItem('refresh_token');
    window.location.href = '/';
  }
}

// Initialize auth manager
window.authManager = new AuthManager();

// Handle callback if on callback page
if (window.location.pathname === '/callback') {
  window.authManager.handleCallback();
}
</code></pre>
<h3>STEP 5: Implement A2P Payment Processing</h3>
<p><strong>src/js/payment.js:</strong></p>
<pre><code class="language-javascript">class PaymentManager {
  constructor() {
    this.paymentEndpoint = 'https://payment-gateway.example.com/mandate';
  }

  // Generate payment mandate
  async createMandate(orderData) {
    const mandate = {
      mandate_id: this.generateUUID(),
      amount: orderData.total,
      currency: 'USD',
      merchant_id: 'your-merchant-id',
      timestamp: new Date().toISOString(),
      nonce: this.generateRandomString(32),
      items: orderData.items
    };
    
    return mandate;
  }

  // Sign mandate with cryptographic signature
  async signMandate(mandate) {
    // In production, use Web Crypto API or backend signing
    const mandateString = JSON.stringify(mandate);
    const encoder = new TextEncoder();
    const data = encoder.encode(mandateString);
    
    // Generate signature (simplified - use proper crypto in production)
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const signature = btoa(String.fromCharCode(...new Uint8Array(hashBuffer)));
    
    return signature;
  }

  // Submit payment mandate
  async processPayment(orderData) {
    const mandate = await this.createMandate(orderData);
    const signature = await this.signMandate(mandate);
    
    const response = await fetch(this.paymentEndpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${window.authManager.getAccessToken()}`
      },
      body: JSON.stringify({
        mandate: mandate,
        signature: signature,
        public_key: 'your-public-key'
      })
    });
    
    if (!response.ok) {
      throw new Error('Payment processing failed');
    }
    
    return await response.json();
  }

  generateUUID() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      const r = Math.random() * 16 | 0;
      const v = c === 'x' ? r : (r &amp; 0x3 | 0x8);
      return v.toString(16);
    });
  }

  generateRandomString(length) {
    const array = new Uint8Array(length);
    crypto.getRandomValues(array);
    return Array.from(array, byte =&gt; byte.toString(16).padStart(2, '0')).join('');
  }
}

window.paymentManager = new PaymentManager();
</code></pre>
<h3>STEP 6: Implement WebSocket Data Streaming</h3>
<p><strong>src/js/websocket.js:</strong></p>
<pre><code class="language-javascript">class DataStreamManager {
  constructor() {
    this.wsEndpoint = 'wss://stream.example.com/data';
    this.ws = null;
    this.reconnectAttempts = 0;
    this.maxReconnectAttempts = 5;
  }

  // Connect to WebSocket server
  connect() {
    if (!this.hasUserConsent()) {
      console.log('User has not consented to data streaming');
      return;
    }
    
    const token = window.authManager.getAccessToken();
    this.ws = new WebSocket(`${this.wsEndpoint}?token=${token}`);
    
    this.ws.onopen = () =&gt; {
      console.log('WebSocket connected');
      this.reconnectAttempts = 0;
    };
    
    this.ws.onmessage = (event) =&gt; {
      const data = JSON.parse(event.data);
      this.handleMessage(data);
    };
    
    this.ws.onerror = (error) =&gt; {
      console.error('WebSocket error:', error);
    };
    
    this.ws.onclose = () =&gt; {
      console.log('WebSocket disconnected');
      this.reconnect();
    };
  }

  // Send event to Google AI
  sendEvent(eventType, eventData) {
    if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {
      console.warn('WebSocket not connected');
      return;
    }
    
    const event = {
      type: eventType,
      data: eventData,
      timestamp: new Date().toISOString(),
      user_id: this.getUserId()
    };
    
    this.ws.send(JSON.stringify(event));
  }

  // Handle incoming messages (AI recommendations)
  handleMessage(data) {
    if (data.type === 'recommendation') {
      this.displayRecommendations(data.products);
    } else if (data.type === 'personalization') {
      this.applyPersonalization(data.settings);
    }
  }

  // Reconnect logic
  reconnect() {
    if (this.reconnectAttempts &gt;= this.maxReconnectAttempts) {
      console.error('Max reconnection attempts reached');
      return;
    }
    
    this.reconnectAttempts++;
    const delay = Math.min(1000 * Math.pow(2, this.reconnectAttempts), 30000);
    
    setTimeout(() =&gt; {
      console.log(`Reconnecting... (attempt ${this.reconnectAttempts})`);
      this.connect();
    }, delay);
  }

  hasUserConsent() {
    return localStorage.getItem('data_streaming_consent') === 'true';
  }

  getUserId() {
    // Extract from ID token or session
    return 'user-id-placeholder';
  }

  displayRecommendations(products) {
    // Update UI with recommended products
    console.log('Received recommendations:', products);
  }

  applyPersonalization(settings) {
    // Apply personalization settings to UI
    console.log('Applying personalization:', settings);
  }

  disconnect() {
    if (this.ws) {
      this.ws.close();
    }
  }
}

window.dataStreamManager = new DataStreamManager();
</code></pre>
<h3>STEP 7: Implement Main Application Logic</h3>
<p><strong>src/js/main.js:</strong></p>
<pre><code class="language-javascript">// Initialize application
document.addEventListener('DOMContentLoaded', () =&gt; {
  initializeAuth();
  initializeCart();
  initializeDataStreaming();
  attachEventListeners();
});

function initializeAuth() {
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  
  if (window.authManager.isAuthenticated()) {
    loginBtn?.classList.add('hidden');
    logoutBtn?.classList.remove('hidden');
  } else {
    loginBtn?.classList.remove('hidden');
    logoutBtn?.classList.add('hidden');
  }
  
  loginBtn?.addEventListener('click', () =&gt; {
    window.authManager.login();
  });
  
  logoutBtn?.addEventListener('click', () =&gt; {
    window.authManager.logout();
  });
}

function initializeCart() {
  // Load cart from localStorage
  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  updateCartUI(cart);
}

function initializeDataStreaming() {
  if (window.authManager.isAuthenticated()) {
    window.dataStreamManager.connect();
    
    // Track page view
    window.dataStreamManager.sendEvent('pageview', {
      page: window.location.pathname,
      title: document.title
    });
  }
}

function attachEventListeners() {
  // Add to cart buttons
  document.querySelectorAll('[data-product-id]').forEach(button =&gt; {
    button.addEventListener('click', (e) =&gt; {
      const productId = e.target.dataset.productId;
      addToCart(productId);
      
      // Track event
      window.dataStreamManager.sendEvent('add_to_cart', {
        product_id: productId
      });
    });
  });
  
  // Checkout button
  const checkoutBtn = document.getElementById('checkoutBtn');
  checkoutBtn?.addEventListener('click', handleCheckout);
  
  // Consent toggle
  const consentToggle = document.getElementById('consentToggle');
  consentToggle?.addEventListener('change', (e) =&gt; {
    const consent = e.target.checked;
    localStorage.setItem('data_streaming_consent', consent);
    
    if (consent) {
      window.dataStreamManager.connect();
    } else {
      window.dataStreamManager.disconnect();
    }
  });
}

function addToCart(productId) {
  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  cart.push(productId);
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartUI(cart);
}

function updateCartUI(cart) {
  const cartCount = document.getElementById('cartCount');
  if (cartCount) {
    cartCount.textContent = cart.length;
  }
}

async function handleCheckout() {
  if (!window.authManager.isAuthenticated()) {
    alert('Please log in to checkout');
    window.authManager.login();
    return;
  }
  
  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  
  if (cart.length === 0) {
    alert('Your cart is empty');
    return;
  }
  
  try {
    // Calculate total and prepare order data
    const orderData = {
      items: cart,
      total: calculateTotal(cart)
    };
    
    // Process payment
    const result = await window.paymentManager.processPayment(orderData);
    
    if (result.status === 'success') {
      // Track purchase
      window.dataStreamManager.sendEvent('purchase', {
        transaction_id: result.transaction_id,
        total: orderData.total,
        items: cart
      });
      
      // Clear cart
      localStorage.setItem('cart', '[]');
      updateCartUI([]);
      
      // Show confirmation
      window.location.href = '/confirmation?id=' + result.transaction_id;
    }
  } catch (error) {
    console.error('Checkout failed:', error);
    alert('Payment processing failed. Please try again.');
  }
}

function calculateTotal(cart) {
  // Calculate total from cart items
  // In production, fetch current prices from API
  return cart.length * 99.99; // Placeholder
}
</code></pre>
<h3>STEP 8: Create CSS Styles</h3>
<p><strong>src/css/main.css:</strong></p>
<pre><code class="language-css">/* CSS Variables */
:root {
  --color-primary: #2563eb;
  --color-secondary: #64748b;
  --color-success: #10b981;
  --color-danger: #ef4444;
  --color-text: #1e293b;
  --color-bg: #ffffff;
  --color-border: #e2e8f0;
  --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --spacing-unit: 8px;
}

/* Reset */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: var(--font-sans);
  color: var(--color-text);
  background: var(--color-bg);
  line-height: 1.6;
}

/* Container */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 calc(var(--spacing-unit) * 2);
}

/* Hero Section */
.hero {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: calc(var(--spacing-unit) * 10) 0;
  text-align: center;
}

.hero h1 {
  font-size: 3rem;
  margin-bottom: calc(var(--spacing-unit) * 2);
}

/* Product Grid */
.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: calc(var(--spacing-unit) * 3);
  margin-top: calc(var(--spacing-unit) * 4);
}

/* Product Card (BEM) */
.product-card {
  background: white;
  border: 1px solid var(--color-border);
  border-radius: 8px;
  overflow: hidden;
  transition: transform 0.2s, box-shadow 0.2s;
}

.product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
}

.product-card__image {
  width: 100%;
  height: 200px;
  object-fit: cover;
}

.product-card__content {
  padding: calc(var(--spacing-unit) * 2);
}

.product-card__title {
  font-size: 1.25rem;
  margin-bottom: calc(var(--spacing-unit));
}

.product-card__description {
  color: var(--color-secondary);
  margin-bottom: calc(var(--spacing-unit) * 2);
}

.product-card__footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.product-card__price {
  font-size: 1.5rem;
  font-weight: bold;
  color: var(--color-primary);
}

/* Button */
.btn {
  padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 3);
  border: none;
  border-radius: 6px;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.2s;
}

.btn--primary {
  background: var(--color-primary);
  color: white;
}

.btn--primary:hover {
  background: #1d4ed8;
}

/* Utility */
.hidden {
  display: none;
}

/* Responsive */
@media (max-width: 768px) {
  .hero h1 {
    font-size: 2rem;
  }
  
  .product-grid {
    grid-template-columns: 1fr;
  }
}
</code></pre>
<h3>STEP 9: Environment Configuration</h3>
<p>Create <strong>.env.example:</strong></p>
<pre><code class="language-bash"># =============================================================================
# ENVIRONMENT CONFIGURATION - .env.example
# =============================================================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env to version control
# =============================================================================

# -----------------------------------------------------------------------------
# SHOPIFY STOREFRONT API (Public - for 11ty build)
# -----------------------------------------------------------------------------
SHOPIFY_STORE_DOMAIN=your-store.myshopify.com
SHOPIFY_STOREFRONT_ACCESS_TOKEN=shpat_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SHOPIFY_STOREFRONT_API_VERSION=2024-01

# -----------------------------------------------------------------------------
# SHOPIFY ADMIN API (Private - for middleware/backend only)
# -----------------------------------------------------------------------------
SHOPIFY_ADMIN_ACCESS_TOKEN=shpat_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SHOPIFY_THEME_ID=123456789012

# -----------------------------------------------------------------------------
# SHOPIFY UCP CATALOG API
# -----------------------------------------------------------------------------
UCP_CATALOG_API_URL=https://catalog.shopify.com/api/v1
UCP_CLIENT_ID=your-ucp-client-id
UCP_CLIENT_SECRET=your-ucp-client-secret

# -----------------------------------------------------------------------------
# WEBFLOW API (Design Module Export)
# -----------------------------------------------------------------------------
WEBFLOW_API_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
WEBFLOW_SITE_ID=xxxxxxxxxxxxxxxxxxxxxxxx
WEBFLOW_COLLECTION_ID=xxxxxxxxxxxxxxxxxxxxxxxx

# -----------------------------------------------------------------------------
# XANO MIDDLEWARE
# -----------------------------------------------------------------------------
XANO_API_BASE_URL=https://your-instance.xano.io/api
XANO_API_KEY=xano_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
XANO_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# -----------------------------------------------------------------------------
# AUTHENTICATION (OAuth 2.0)
# -----------------------------------------------------------------------------
OAUTH_CLIENT_ID=your-oauth-client-id
OAUTH_CLIENT_SECRET=your-oauth-client-secret
OAUTH_AUTHORIZE_URL=https://identity-provider.example.com/authorize
OAUTH_TOKEN_URL=https://identity-provider.example.com/token
OAUTH_REDIRECT_URI=https://your-site.com/callback

# -----------------------------------------------------------------------------
# JWT CONFIGURATION
# -----------------------------------------------------------------------------
JWT_SECRET=your-256-bit-secret-key-here-minimum-32-chars
JWT_ISSUER=your-app-name
JWT_AUDIENCE=your-api-audience
JWT_EXPIRY_HOURS=24

# -----------------------------------------------------------------------------
# GOOGLE AI / ANALYTICS
# -----------------------------------------------------------------------------
GOOGLE_AI_PROJECT_ID=your-gcp-project-id
GOOGLE_AI_STREAM_ID=your-datastream-id
GOOGLE_AI_STREAM_URL=wss://stream.google.com/data
GOOGLE_AI_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
GOOGLE_AI_SERVICE_ACCOUNT_KEY={&quot;type&quot;:&quot;service_account&quot;,&quot;project_id&quot;:&quot;...&quot;}

# -----------------------------------------------------------------------------
# WEBSOCKET / REAL-TIME
# -----------------------------------------------------------------------------
WEBSOCKET_SERVER_URL=wss://your-websocket-server.com
WEBSOCKET_API_KEY=ws_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# -----------------------------------------------------------------------------
# PAYMENT GATEWAY (A2P)
# -----------------------------------------------------------------------------
PAYMENT_GATEWAY_URL=https://payment-gateway.example.com
PAYMENT_MERCHANT_ID=merch_xxxxxxxxxxxxx
PAYMENT_PUBLIC_KEY=pk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
PAYMENT_SECRET_KEY=sk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# -----------------------------------------------------------------------------
# DEPLOYMENT / CI-CD
# -----------------------------------------------------------------------------
NETLIFY_AUTH_TOKEN=nfp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NETLIFY_SITE_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
GITHUB_TOKEN=ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# -----------------------------------------------------------------------------
# IDEMPOTENCY / CACHING
# -----------------------------------------------------------------------------
REDIS_URL=redis://username:password@host:6379
IDEMPOTENCY_TTL_HOURS=24
CACHE_TTL_SECONDS=3600

# -----------------------------------------------------------------------------
# SECURITY
# -----------------------------------------------------------------------------
WEBHOOK_SIGNING_SECRET=whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ENCRYPTION_KEY=32-character-encryption-key-here
HMAC_SECRET=your-hmac-signing-secret

# -----------------------------------------------------------------------------
# FEATURE FLAGS
# -----------------------------------------------------------------------------
ENABLE_GOOGLE_AI_STREAMING=true
ENABLE_SHOPIFY_SYNC=true
ENABLE_WEBHOOK_RETRY=true
DEBUG_MODE=false

# -----------------------------------------------------------------------------
# RATE LIMITING
# -----------------------------------------------------------------------------
RATE_LIMIT_REQUESTS_PER_MINUTE=100
RATE_LIMIT_BURST=20
</code></pre>
<h3>STEP 10: API Endpoint Schema Reference</h3>
<p>This section defines all API endpoints for Users, Products, UCP Sessions, and Idempotency management.</p>
<h4>10.1 Users API</h4>
<p><strong>Base URL:</strong> <code>https://your-middleware.xano.io/api/v1/users</code></p>
<p><strong>Create User:</strong></p>
<pre><code>POST /users
Content-Type: application/json

Request:
{
  &quot;email&quot;: &quot;user@example.com&quot;,
  &quot;name&quot;: &quot;John Doe&quot;,
  &quot;consent_analytics&quot;: true,
  &quot;consent_marketing&quot;: false,
  &quot;ucp_session_id&quot;: &quot;session_123456&quot;
}

Response (201 Created):
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;user_id&quot;: &quot;usr_abc123def456&quot;,
    &quot;email&quot;: &quot;user@example.com&quot;,
    &quot;name&quot;: &quot;John Doe&quot;,
    &quot;shopify_customer_id&quot;: &quot;gid://shopify/Customer/789&quot;,
    &quot;consent_status&quot;: {
      &quot;analytics&quot;: { &quot;granted&quot;: true, &quot;timestamp&quot;: &quot;2026-01-14T12:00:00Z&quot; },
      &quot;marketing&quot;: { &quot;granted&quot;: false, &quot;timestamp&quot;: &quot;2026-01-14T12:00:00Z&quot; }
    },
    &quot;created_at&quot;: &quot;2026-01-14T12:00:00Z&quot;
  },
  &quot;idempotency_key&quot;: &quot;usr_abc123def456_create_1705233600000&quot;
}
</code></pre>
<p><strong>Get User:</strong></p>
<pre><code>GET /users/{user_id}

Response (200 OK):
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;user_id&quot;: &quot;usr_abc123def456&quot;,
    &quot;email&quot;: &quot;user@example.com&quot;,
    &quot;name&quot;: &quot;John Doe&quot;,
    &quot;shopify_customer_id&quot;: &quot;gid://shopify/Customer/789&quot;,
    &quot;consent_status&quot;: {
      &quot;analytics&quot;: { &quot;granted&quot;: true, &quot;timestamp&quot;: &quot;2026-01-14T12:00:00Z&quot; },
      &quot;marketing&quot;: { &quot;granted&quot;: false, &quot;timestamp&quot;: &quot;2026-01-14T12:00:00Z&quot; }
    },
    &quot;ucp_tags&quot;: [&quot;returning-customer&quot;, &quot;newsletter-subscriber&quot;],
    &quot;last_event_type&quot;: &quot;page_view&quot;,
    &quot;last_event_timestamp&quot;: &quot;2026-01-14T14:30:00Z&quot;,
    &quot;sync_status&quot;: {
      &quot;shopify_synced&quot;: true,
      &quot;google_ai_synced&quot;: true,
      &quot;last_synced&quot;: &quot;2026-01-14T14:30:00Z&quot;
    },
    &quot;created_at&quot;: &quot;2026-01-14T12:00:00Z&quot;,
    &quot;updated_at&quot;: &quot;2026-01-14T14:30:00Z&quot;
  }
}
</code></pre>
<p><strong>Update User Consent:</strong></p>
<pre><code>PATCH /users/{user_id}/consent
Content-Type: application/json

Request:
{
  &quot;consent_analytics&quot;: true,
  &quot;consent_marketing&quot;: true,
  &quot;consent_version&quot;: &quot;v2.1&quot;
}

Response (200 OK):
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;user_id&quot;: &quot;usr_abc123def456&quot;,
    &quot;consent_status&quot;: {
      &quot;analytics&quot;: { &quot;granted&quot;: true, &quot;timestamp&quot;: &quot;2026-01-14T15:00:00Z&quot;, &quot;version&quot;: &quot;v2.1&quot; },
      &quot;marketing&quot;: { &quot;granted&quot;: true, &quot;timestamp&quot;: &quot;2026-01-14T15:00:00Z&quot;, &quot;version&quot;: &quot;v2.1&quot; }
    },
    &quot;webhook_triggered&quot;: true
  },
  &quot;idempotency_key&quot;: &quot;usr_abc123def456_consent_1705237200000&quot;
}
</code></pre>
<p><strong>List Users (Admin):</strong></p>
<pre><code>GET /users?page=1&amp;limit=50&amp;filter[consent_marketing]=true

Response (200 OK):
{
  &quot;success&quot;: true,
  &quot;data&quot;: [
    { &quot;user_id&quot;: &quot;usr_abc123&quot;, &quot;email&quot;: &quot;user1@example.com&quot;, &quot;name&quot;: &quot;John Doe&quot; },
    { &quot;user_id&quot;: &quot;usr_def456&quot;, &quot;email&quot;: &quot;user2@example.com&quot;, &quot;name&quot;: &quot;Jane Smith&quot; }
  ],
  &quot;pagination&quot;: {
    &quot;page&quot;: 1,
    &quot;limit&quot;: 50,
    &quot;total&quot;: 1250,
    &quot;total_pages&quot;: 25
  }
}
</code></pre>
<h4>10.2 Products API</h4>
<p><strong>Base URL:</strong> <code>https://your-middleware.xano.io/api/v1/products</code></p>
<p><strong>List Products:</strong></p>
<pre><code>GET /products?page=1&amp;limit=20&amp;collection={collection_handle}

Response (200 OK):
{
  &quot;success&quot;: true,
  &quot;data&quot;: [
    {
      &quot;product_id&quot;: &quot;prod_abc123&quot;,
      &quot;shopify_id&quot;: &quot;gid://shopify/Product/12345&quot;,
      &quot;title&quot;: &quot;Premium Widget&quot;,
      &quot;handle&quot;: &quot;premium-widget&quot;,
      &quot;description&quot;: &quot;A high-quality widget for all your needs&quot;,
      &quot;price&quot;: { &quot;amount&quot;: &quot;99.99&quot;, &quot;currency_code&quot;: &quot;USD&quot; },
      &quot;compare_at_price&quot;: { &quot;amount&quot;: &quot;129.99&quot;, &quot;currency_code&quot;: &quot;USD&quot; },
      &quot;images&quot;: [{ &quot;url&quot;: &quot;https://cdn.shopify.com/...&quot;, &quot;alt_text&quot;: &quot;Premium Widget&quot; }],
      &quot;available&quot;: true,
      &quot;inventory_quantity&quot;: 150,
      &quot;variants_count&quot;: 3,
      &quot;tags&quot;: [&quot;featured&quot;, &quot;best-seller&quot;],
      &quot;last_synced&quot;: &quot;2026-01-14T10:00:00Z&quot;
    }
  ],
  &quot;pagination&quot;: {
    &quot;page&quot;: 1,
    &quot;limit&quot;: 20,
    &quot;total&quot;: 500,
    &quot;total_pages&quot;: 25,
    &quot;has_next_page&quot;: true,
    &quot;cursor&quot;: &quot;eyJsYXN0X2lkIjogMTIzNDV9&quot;
  }
}
</code></pre>
<p><strong>Get Product Detail:</strong></p>
<pre><code>GET /products/{product_handle}

Response (200 OK):
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;product_id&quot;: &quot;prod_abc123&quot;,
    &quot;shopify_id&quot;: &quot;gid://shopify/Product/12345&quot;,
    &quot;title&quot;: &quot;Premium Widget&quot;,
    &quot;handle&quot;: &quot;premium-widget&quot;,
    &quot;description&quot;: &quot;A high-quality widget for all your needs&quot;,
    &quot;description_html&quot;: &quot;&lt;p&gt;A high-quality widget...&lt;/p&gt;&quot;,
    &quot;price_range&quot;: {
      &quot;min&quot;: { &quot;amount&quot;: &quot;89.99&quot;, &quot;currency_code&quot;: &quot;USD&quot; },
      &quot;max&quot;: { &quot;amount&quot;: &quot;119.99&quot;, &quot;currency_code&quot;: &quot;USD&quot; }
    },
    &quot;images&quot;: [
      { &quot;id&quot;: &quot;img_1&quot;, &quot;url&quot;: &quot;https://cdn.shopify.com/...&quot;, &quot;alt_text&quot;: &quot;Front view&quot;, &quot;position&quot;: 1 },
      { &quot;id&quot;: &quot;img_2&quot;, &quot;url&quot;: &quot;https://cdn.shopify.com/...&quot;, &quot;alt_text&quot;: &quot;Side view&quot;, &quot;position&quot;: 2 }
    ],
    &quot;variants&quot;: [
      {
        &quot;variant_id&quot;: &quot;var_001&quot;,
        &quot;shopify_id&quot;: &quot;gid://shopify/ProductVariant/111&quot;,
        &quot;title&quot;: &quot;Small / Blue&quot;,
        &quot;sku&quot;: &quot;WIDGET-SM-BLU&quot;,
        &quot;price&quot;: { &quot;amount&quot;: &quot;89.99&quot;, &quot;currency_code&quot;: &quot;USD&quot; },
        &quot;available&quot;: true,
        &quot;inventory_quantity&quot;: 50,
        &quot;options&quot;: { &quot;size&quot;: &quot;Small&quot;, &quot;color&quot;: &quot;Blue&quot; }
      }
    ],
    &quot;collections&quot;: [&quot;widgets&quot;, &quot;featured&quot;],
    &quot;tags&quot;: [&quot;featured&quot;, &quot;best-seller&quot;, &quot;new-arrival&quot;],
    &quot;seo&quot;: { &quot;title&quot;: &quot;Premium Widget - Best Quality&quot;, &quot;description&quot;: &quot;Shop our premium widget...&quot; },
    &quot;created_at&quot;: &quot;2025-12-01T10:00:00Z&quot;,
    &quot;updated_at&quot;: &quot;2026-01-14T10:00:00Z&quot;,
    &quot;last_synced&quot;: &quot;2026-01-14T10:00:00Z&quot;
  }
}
</code></pre>
<p><strong>Sync Products:</strong></p>
<pre><code>POST /products/sync
Content-Type: application/json

Request:
{
  &quot;sync_type&quot;: &quot;full&quot;,
  &quot;collection_handles&quot;: [&quot;all&quot;],
  &quot;force_refresh&quot;: false
}

Response (202 Accepted):
{
  &quot;success&quot;: true,
  &quot;message&quot;: &quot;Product sync initiated&quot;,
  &quot;job_id&quot;: &quot;sync_job_123456&quot;,
  &quot;estimated_products&quot;: 500,
  &quot;webhook_url&quot;: &quot;https://your-middleware.xano.io/api/v1/products/sync/status/sync_job_123456&quot;
}
</code></pre>
<h4>10.3 UCP Session API</h4>
<p><strong>Base URL:</strong> <code>https://your-middleware.xano.io/api/v1/ucp</code></p>
<p><strong>Create/Update Session:</strong></p>
<pre><code>POST /ucp/session
Content-Type: application/json

Request:
{
  &quot;session_id&quot;: &quot;session_123456789&quot;,
  &quot;user_id&quot;: &quot;usr_abc123def456&quot;,
  &quot;device_info&quot;: { &quot;type&quot;: &quot;mobile&quot;, &quot;browser&quot;: &quot;Chrome&quot;, &quot;os&quot;: &quot;iOS 17&quot; },
  &quot;referrer&quot;: &quot;https://google.com&quot;,
  &quot;landing_page&quot;: &quot;/products/premium-widget&quot;
}

Response (200 OK):
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;session_id&quot;: &quot;session_123456789&quot;,
    &quot;user_id&quot;: &quot;usr_abc123def456&quot;,
    &quot;is_new_session&quot;: true,
    &quot;consent_required&quot;: true,
    &quot;ucp_tags&quot;: [&quot;mobile-user&quot;, &quot;organic-traffic&quot;],
    &quot;created_at&quot;: &quot;2026-01-14T12:00:00Z&quot;
  }
}
</code></pre>
<p><strong>Track Event:</strong></p>
<pre><code>POST /ucp/event
Content-Type: application/json

Request:
{
  &quot;session_id&quot;: &quot;session_123456789&quot;,
  &quot;event_type&quot;: &quot;add_to_cart&quot;,
  &quot;event_data&quot;: {
    &quot;product_id&quot;: &quot;prod_abc123&quot;,
    &quot;variant_id&quot;: &quot;var_001&quot;,
    &quot;quantity&quot;: 1,
    &quot;price&quot;: 89.99
  },
  &quot;page&quot;: &quot;/products/premium-widget&quot;,
  &quot;timestamp&quot;: &quot;2026-01-14T12:05:00Z&quot;
}

Response (200 OK):
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;event_id&quot;: &quot;evt_xyz789&quot;,
    &quot;session_id&quot;: &quot;session_123456789&quot;,
    &quot;event_type&quot;: &quot;add_to_cart&quot;,
    &quot;processed&quot;: true,
    &quot;synced_to&quot;: { &quot;shopify&quot;: true, &quot;google_ai&quot;: true },
    &quot;ucp_tags_updated&quot;: [&quot;cart-active&quot;, &quot;high-intent&quot;]
  },
  &quot;idempotency_key&quot;: &quot;session_123456789_add_to_cart_1705234500000&quot;
}
</code></pre>
<p><strong>Update UCP Tags (onChange Event):</strong></p>
<pre><code>PATCH /ucp/session/{session_id}/tags
Content-Type: application/json

Request:
{
  &quot;add_tags&quot;: [&quot;vip-customer&quot;, &quot;loyalty-member&quot;],
  &quot;remove_tags&quot;: [&quot;first-time-visitor&quot;],
  &quot;trigger_webhook&quot;: true
}

Response (200 OK):
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;session_id&quot;: &quot;session_123456789&quot;,
    &quot;ucp_tags&quot;: [&quot;mobile-user&quot;, &quot;organic-traffic&quot;, &quot;vip-customer&quot;, &quot;loyalty-member&quot;, &quot;cart-active&quot;],
    &quot;tags_added&quot;: [&quot;vip-customer&quot;, &quot;loyalty-member&quot;],
    &quot;tags_removed&quot;: [&quot;first-time-visitor&quot;],
    &quot;webhook_triggered&quot;: true,
    &quot;webhook_status&quot;: &quot;delivered&quot;
  }
}
</code></pre>
<p><strong>Get Session History:</strong></p>
<pre><code>GET /ucp/session/{session_id}/history?limit=50

Response (200 OK):
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;session_id&quot;: &quot;session_123456789&quot;,
    &quot;user_id&quot;: &quot;usr_abc123def456&quot;,
    &quot;events&quot;: [
      { &quot;event_id&quot;: &quot;evt_001&quot;, &quot;event_type&quot;: &quot;page_view&quot;, &quot;page&quot;: &quot;/&quot;, &quot;timestamp&quot;: &quot;2026-01-14T12:00:00Z&quot; },
      { &quot;event_id&quot;: &quot;evt_002&quot;, &quot;event_type&quot;: &quot;page_view&quot;, &quot;page&quot;: &quot;/products/premium-widget&quot;, &quot;timestamp&quot;: &quot;2026-01-14T12:02:00Z&quot; },
      { &quot;event_id&quot;: &quot;evt_003&quot;, &quot;event_type&quot;: &quot;add_to_cart&quot;, &quot;data&quot;: { &quot;product_id&quot;: &quot;prod_abc123&quot;, &quot;quantity&quot;: 1 }, &quot;timestamp&quot;: &quot;2026-01-14T12:05:00Z&quot; }
    ],
    &quot;total_events&quot;: 3,
    &quot;session_duration_seconds&quot;: 300,
    &quot;pages_viewed&quot;: 2
  }
}
</code></pre>
<h4>10.4 Idempotency API</h4>
<p><strong>Base URL:</strong> <code>https://your-middleware.xano.io/api/v1/idempotency</code></p>
<p><strong>Check Idempotency Key:</strong></p>
<pre><code>GET /idempotency/{idempotency_key}

Response (200 OK - Key Exists):
{
  &quot;exists&quot;: true,
  &quot;data&quot;: {
    &quot;idempotency_key&quot;: &quot;usr_abc123_consent_1705237200000&quot;,
    &quot;operation&quot;: &quot;consent_update&quot;,
    &quot;status&quot;: &quot;completed&quot;,
    &quot;result&quot;: { &quot;success&quot;: true, &quot;user_id&quot;: &quot;usr_abc123def456&quot;, &quot;consent_updated&quot;: true },
    &quot;created_at&quot;: &quot;2026-01-14T15:00:00Z&quot;,
    &quot;expires_at&quot;: &quot;2026-01-15T15:00:00Z&quot;
  }
}

Response (404 Not Found - Key Does Not Exist):
{
  &quot;exists&quot;: false,
  &quot;message&quot;: &quot;Idempotency key not found - safe to process&quot;
}
</code></pre>
<p><strong>Create Idempotency Record:</strong></p>
<pre><code>POST /idempotency
Content-Type: application/json

Request:
{
  &quot;idempotency_key&quot;: &quot;usr_abc123_consent_1705237200000&quot;,
  &quot;operation&quot;: &quot;consent_update&quot;,
  &quot;entity_type&quot;: &quot;user&quot;,
  &quot;entity_id&quot;: &quot;usr_abc123def456&quot;,
  &quot;request_hash&quot;: &quot;sha256_of_request_body&quot;,
  &quot;ttl_hours&quot;: 24
}

Response (201 Created):
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;idempotency_key&quot;: &quot;usr_abc123_consent_1705237200000&quot;,
    &quot;status&quot;: &quot;processing&quot;,
    &quot;lock_acquired&quot;: true,
    &quot;created_at&quot;: &quot;2026-01-14T15:00:00Z&quot;,
    &quot;expires_at&quot;: &quot;2026-01-15T15:00:00Z&quot;
  }
}
</code></pre>
<p><strong>Update Idempotency Status:</strong></p>
<pre><code>PATCH /idempotency/{idempotency_key}
Content-Type: application/json

Request:
{
  &quot;status&quot;: &quot;completed&quot;,
  &quot;result&quot;: { &quot;success&quot;: true, &quot;user_id&quot;: &quot;usr_abc123def456&quot;, &quot;consent_updated&quot;: true }
}

Response (200 OK):
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;idempotency_key&quot;: &quot;usr_abc123_consent_1705237200000&quot;,
    &quot;status&quot;: &quot;completed&quot;,
    &quot;updated_at&quot;: &quot;2026-01-14T15:00:01Z&quot;
  }
}
</code></pre>
<p><strong>List Failed Operations (Admin):</strong></p>
<pre><code>GET /idempotency?status=failed&amp;entity_type=user&amp;limit=100

Response (200 OK):
{
  &quot;success&quot;: true,
  &quot;data&quot;: [
    {
      &quot;idempotency_key&quot;: &quot;usr_def456_consent_1705230000000&quot;,
      &quot;operation&quot;: &quot;consent_update&quot;,
      &quot;entity_type&quot;: &quot;user&quot;,
      &quot;entity_id&quot;: &quot;usr_def456&quot;,
      &quot;status&quot;: &quot;failed&quot;,
      &quot;error_message&quot;: &quot;Shopify API timeout&quot;,
      &quot;retry_count&quot;: 3,
      &quot;created_at&quot;: &quot;2026-01-14T13:00:00Z&quot;
    }
  ],
  &quot;pagination&quot;: { &quot;page&quot;: 1, &quot;limit&quot;: 100, &quot;total&quot;: 5 }
}
</code></pre>
<p><strong>Retry Failed Operation:</strong></p>
<pre><code>POST /idempotency/{idempotency_key}/retry

Response (202 Accepted):
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;idempotency_key&quot;: &quot;usr_def456_consent_1705230000000&quot;,
    &quot;status&quot;: &quot;processing&quot;,
    &quot;retry_count&quot;: 4,
    &quot;message&quot;: &quot;Retry initiated&quot;
  }
}
</code></pre>
<h4>10.5 Webhook Management API</h4>
<p><strong>Base URL:</strong> <code>https://your-middleware.xano.io/api/v1/webhooks</code></p>
<p><strong>Register Webhook:</strong></p>
<pre><code>POST /webhooks
Content-Type: application/json

Request:
{
  &quot;url&quot;: &quot;https://your-endpoint.com/webhook&quot;,
  &quot;events&quot;: [&quot;user.consent_updated&quot;, &quot;user.tags_changed&quot;, &quot;session.created&quot;],
  &quot;secret&quot;: &quot;your_webhook_secret&quot;,
  &quot;active&quot;: true
}

Response (201 Created):
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;webhook_id&quot;: &quot;wh_abc123&quot;,
    &quot;url&quot;: &quot;https://your-endpoint.com/webhook&quot;,
    &quot;events&quot;: [&quot;user.consent_updated&quot;, &quot;user.tags_changed&quot;, &quot;session.created&quot;],
    &quot;status&quot;: &quot;active&quot;,
    &quot;created_at&quot;: &quot;2026-01-14T12:00:00Z&quot;
  }
}
</code></pre>
<p><strong>Webhook Delivery Log:</strong></p>
<pre><code>GET /webhooks/{webhook_id}/deliveries?limit=50

Response (200 OK):
{
  &quot;success&quot;: true,
  &quot;data&quot;: [
    {
      &quot;delivery_id&quot;: &quot;del_xyz789&quot;,
      &quot;webhook_id&quot;: &quot;wh_abc123&quot;,
      &quot;event&quot;: &quot;user.consent_updated&quot;,
      &quot;payload&quot;: { &quot;user_id&quot;: &quot;usr_abc123&quot;, &quot;consent_marketing&quot;: true },
      &quot;status&quot;: &quot;delivered&quot;,
      &quot;response_code&quot;: 200,
      &quot;response_time_ms&quot;: 145,
      &quot;delivered_at&quot;: &quot;2026-01-14T15:00:01Z&quot;
    }
  ],
  &quot;pagination&quot;: { &quot;page&quot;: 1, &quot;limit&quot;: 50, &quot;total&quot;: 250 }
}
</code></pre>
<h4>10.6 User Session State Management</h4>
<p><strong>User GraphQL Query (Shopify Admin API):</strong></p>
<pre><code class="language-graphql">query GetCustomer($id: ID!) {
  customer(id: $id) {
    id
    email
    firstName
    lastName
    displayName
    tags
    verifiedEmail

    emailMarketingConsent {
      marketingState
      marketingOptInLevel
      consentUpdatedAt
    }

    orders(first: 10, sortKey: CREATED_AT, reverse: true) {
      edges {
        node {
          id
          name
          createdAt
          totalPriceSet { shopMoney { amount, currencyCode } }
          fulfillmentStatus
        }
      }
    }

    metafields(first: 20, namespace: &quot;ucp&quot;) {
      edges {
        node { id, namespace, key, value, type }
      }
    }
  }
}
</code></pre>
<p><strong>Update Customer with UCP Data (Mutation):</strong></p>
<pre><code class="language-graphql">mutation UpdateCustomerWithUCP($input: CustomerInput!) {
  customerUpdate(input: $input) {
    customer {
      id
      email
      tags
      metafields(first: 20, namespace: &quot;ucp&quot;) {
        edges { node { key, value } }
      }
    }
    userErrors { field, message }
  }
}
</code></pre>
<p><strong>User Schema Mapper (scripts/user-schema-mapper.js):</strong></p>
<pre><code class="language-javascript">function generateIdempotencyKey(userId, eventType) {
  return `${userId}_${eventType}_${Date.now()}`;
}

function mapUserToWebflow(userData, sessionData, consentData) {
  const { userId, email, name, shopifyCustomerId } = userData;
  const { sessionId, deviceInfo, events = [] } = sessionData || {};
  const { analytics = false, marketing = false, version = 'v1.0', timestamp } = consentData || {};

  return {
    name: name || email?.split('@')[0] || 'Anonymous',
    slug: userId,
    'user-id': userId,
    'email': email || '',
    'shopify-customer-id': shopifyCustomerId || '',
    'consent-status': JSON.stringify({
      analytics: { granted: analytics, timestamp: timestamp || new Date().toISOString() },
      marketing: { granted: marketing, timestamp: timestamp || new Date().toISOString() }
    }),
    'consent-analytics': analytics,
    'consent-marketing': marketing,
    'consent-timestamp': timestamp || new Date().toISOString(),
    'consent-version': version,
    'ucp-session-id': sessionId || '',
    'ucp-tags': JSON.stringify(generateUserTags(userData, sessionData, consentData)),
    'last-event-type': events[events.length - 1]?.type || 'session_start',
    'last-event-timestamp': events[events.length - 1]?.timestamp || new Date().toISOString(),
    'event-history': JSON.stringify(events.slice(-50)),
    'idempotency-key': generateIdempotencyKey(userId, 'user_sync'),
    'last-processed-at': new Date().toISOString(),
    'processing-status': 'completed',
    'shopify-synced': !!shopifyCustomerId,
    'google-ai-synced': true,
    'last-synced': new Date().toISOString(),
  };
}

function generateUserTags(userData, sessionData, consentData) {
  const tags = [];
  if (sessionData?.deviceInfo?.type === 'mobile') tags.push('mobile-user');
  if (sessionData?.deviceInfo?.type === 'desktop') tags.push('desktop-user');
  if (consentData?.analytics) tags.push('analytics-consent');
  if (consentData?.marketing) tags.push('marketing-consent');
  if ((sessionData?.events?.length || 0) &gt; 10) tags.push('high-engagement');
  if (sessionData?.events?.some(e =&gt; e.type === 'add_to_cart')) tags.push('cart-active');
  return tags;
}

function mapConsentUpdate(userId, consentData) {
  return {
    'consent-analytics': consentData.analytics,
    'consent-marketing': consentData.marketing,
    'consent-timestamp': new Date().toISOString(),
    'consent-version': consentData.version || 'v1.0',
    'idempotency-key': generateIdempotencyKey(userId, 'consent_update'),
    'last-processed-at': new Date().toISOString(),
  };
}

module.exports = { mapUserToWebflow, mapConsentUpdate, generateIdempotencyKey, generateUserTags };
</code></pre>
<p><strong>User Data Fetcher (src/_data/users.js):</strong></p>
<pre><code class="language-javascript">const fetch = require('node-fetch');
require('dotenv').config();

const SHOPIFY_DOMAIN = process.env.SHOPIFY_STORE_DOMAIN;
const ADMIN_TOKEN = process.env.SHOPIFY_ADMIN_ACCESS_TOKEN;
const ADMIN_ENDPOINT = `https://${SHOPIFY_DOMAIN}/admin/api/2024-01/graphql.json`;

async function adminQuery(query, variables = {}) {
  const response = await fetch(ADMIN_ENDPOINT, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-Shopify-Access-Token': ADMIN_TOKEN,
    },
    body: JSON.stringify({ query, variables }),
  });
  const json = await response.json();
  if (json.errors) throw new Error(JSON.stringify(json.errors));
  return json.data;
}

async function fetchCustomerWithUCP(customerId) {
  const query = `
    query GetCustomerUCP($id: ID!) {
      customer(id: $id) {
        id, email, firstName, lastName, tags
        emailMarketingConsent { marketingState, consentUpdatedAt }
        metafields(first: 20, namespace: &quot;ucp&quot;) {
          edges { node { key, value, type } }
        }
      }
    }
  `;
  const data = await adminQuery(query, { id: customerId });
  return parseCustomerData(data.customer);
}

function parseCustomerData(customer) {
  const metafields = {};
  customer.metafields?.edges?.forEach(({ node }) =&gt; {
    metafields[node.key] = node.type === 'json' ? JSON.parse(node.value) : node.value;
  });
  return {
    userId: customer.id,
    email: customer.email,
    name: `${customer.firstName || ''} ${customer.lastName || ''}`.trim(),
    tags: customer.tags || [],
    consent: {
      marketing: customer.emailMarketingConsent?.marketingState === 'SUBSCRIBED',
      timestamp: customer.emailMarketingConsent?.consentUpdatedAt,
    },
    ucp: {
      sessionId: metafields.session_id || null,
      consentStatus: metafields.consent_status || {},
      lastEvent: metafields.last_event || null,
      userTags: metafields.user_tags || [],
    },
  };
}

async function updateCustomerUCP(customerId, ucpData) {
  const mutation = `
    mutation UpdateCustomerUCP($input: CustomerInput!) {
      customerUpdate(input: $input) {
        customer { id, tags }
        userErrors { field, message }
      }
    }
  `;
  const input = {
    id: customerId,
    tags: ucpData.tags || [],
    metafields: [
      { namespace: 'ucp', key: 'consent_status', value: JSON.stringify(ucpData.consent || {}), type: 'json' },
      { namespace: 'ucp', key: 'session_id', value: ucpData.sessionId || '', type: 'single_line_text_field' },
      { namespace: 'ucp', key: 'last_event', value: JSON.stringify(ucpData.lastEvent || {}), type: 'json' },
      { namespace: 'ucp', key: 'user_tags', value: JSON.stringify(ucpData.userTags || []), type: 'json' },
      { namespace: 'ucp', key: 'idempotency_key', value: `${customerId}_${Date.now()}`, type: 'single_line_text_field' },
    ],
  };
  const data = await adminQuery(mutation, { input });
  if (data.customerUpdate.userErrors?.length &gt; 0) {
    throw new Error(JSON.stringify(data.customerUpdate.userErrors));
  }
  return data.customerUpdate.customer;
}

module.exports = { fetchCustomerWithUCP, updateCustomerUCP, parseCustomerData, adminQuery };
</code></pre>
<h3>STEP 11: Testing and Deployment</h3>
<ol>
<li>
<p><strong>Install dependencies:</strong></p>
<pre><code class="language-bash">npm install
</code></pre>
</li>
<li>
<p><strong>Configure environment:</strong></p>
<pre><code class="language-bash">cp .env.example .env
# Edit .env with your actual credentials
</code></pre>
</li>
<li>
<p><strong>Run development server:</strong></p>
<pre><code class="language-bash">npm start
</code></pre>
</li>
<li>
<p><strong>Build for production:</strong></p>
<pre><code class="language-bash">npm run build
</code></pre>
</li>
<li>
<p><strong>Deploy to CDN:</strong></p>
<ul>
<li>Upload <code>_site/</code> directory to your CDN or static hosting provider</li>
<li>Configure custom domain and SSL certificate</li>
<li>Set up environment variables in hosting platform</li>
</ul>
</li>
</ol>
<h2>SECURITY CHECKLIST</h2>
<ul>
<li>[ ] Use HTTPS/TLS 1.3 for all connections</li>
<li>[ ] Implement PKCE for OAuth 2.0</li>
<li>[ ] Store tokens in httpOnly cookies (not localStorage in production)</li>
<li>[ ] Validate all user inputs</li>
<li>[ ] Implement CSRF protection</li>
<li>[ ] Use Content Security Policy (CSP) headers</li>
<li>[ ] Implement rate limiting on API endpoints</li>
<li>[ ] Encrypt sensitive data at rest</li>
<li>[ ] Regular security audits and dependency updates</li>
<li>[ ] GDPR compliance for user data</li>
<li>[ ] PCI DSS compliance for payment processing</li>
</ul>
<h2>SUCCESS CRITERIA</h2>
<ul>
<li>[ ] CI/CD pipeline successfully publishes to both 11ty and Shopify Native</li>
<li>[ ] Build completes in &lt; 30 seconds</li>
<li>[ ] Page load time &lt; 2 seconds (Lighthouse score &gt; 90)</li>
<li>[ ] All products display correctly from UCP API</li>
<li>[ ] 11ty and Shopify Native pages render identically (parity)</li>
<li>[ ] OAuth 2.0 login flow works end-to-end</li>
<li>[ ] Payment processing succeeds with valid test cards</li>
<li>[ ] WebSocket connection remains stable</li>
<li>[ ] User consent properly tracked and respected</li>
<li>[ ] Mobile responsive design works on all devices</li>
<li>[ ] Cross-browser compatibility (Chrome, Firefox, Safari, Edge)</li>
<li>[ ] Accessibility score &gt; 90 (WCAG 2.1 AA compliant)</li>
<li>[ ] Webflow design changes propagate to both targets automatically</li>
</ul>
<h2>TROUBLESHOOTING</h2>
<p><strong>Build fails:</strong></p>
<ul>
<li>Check Node.js version (v18+ required)</li>
<li>Verify all dependencies installed</li>
<li>Check environment variables are set</li>
</ul>
<p><strong>Products not loading:</strong></p>
<ul>
<li>Verify UCP API credentials</li>
<li>Check API endpoint URL</li>
<li>Inspect network requests in browser DevTools</li>
</ul>
<p><strong>OAuth login fails:</strong></p>
<ul>
<li>Verify redirect URI matches configuration</li>
<li>Check PKCE implementation</li>
<li>Inspect authorization endpoint response</li>
</ul>
<p><strong>Payment processing fails:</strong></p>
<ul>
<li>Verify payment gateway credentials</li>
<li>Check mandate signature generation</li>
<li>Inspect payment endpoint response</li>
</ul>
<p><strong>WebSocket disconnects:</strong></p>
<ul>
<li>Check WebSocket server URL</li>
<li>Verify authentication token</li>
<li>Implement reconnection logic</li>
</ul>
<h2>NEXT STEPS</h2>
<p>After completing the basic implementation:</p>
<ol>
<li><strong>Enhance CI/CD pipeline with automated design sync</strong></li>
<li><strong>Add product search and filtering (works on both 11ty and Shopify Native)</strong></li>
<li><strong>Implement order history page</strong></li>
<li><strong>Add email notifications</strong></li>
<li><strong>Integrate analytics dashboard</strong></li>
<li><strong>Implement A/B testing across both platforms</strong></li>
<li><strong>Add multi-language support</strong></li>
<li><strong>Optimize images and assets</strong></li>
<li><strong>Implement progressive web app (PWA) features</strong></li>
<li><strong>Add automated testing (unit, integration, e2e)</strong></li>
<li><strong>Set up parity testing between 11ty and Shopify Native</strong></li>
<li><strong>Implement automatic failover from 11ty to Shopify Native</strong></li>
</ol>
<h2>RESOURCES</h2>
<ul>
<li><a href="https://www.11ty.dev/docs/">Eleventy Documentation</a></li>
<li><a href="https://ucp.dev/">Shopify UCP Specification</a></li>
<li><a href="https://oauth.net/2/">OAuth 2.0 RFC</a></li>
<li><a href="https://ap2-protocol.org/">A2P Protocol Specification</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API">Web Crypto API</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket">WebSocket API</a></li>
</ul>
<hr>
<p><strong>END OF IMPLEMENTATION PROMPT</strong></p>
<pre><code>
---

## How to Use This Prompt

1. **Copy the entire prompt** (everything between the triple backticks in the &quot;Prompt for LLM&quot; section)
2. **Paste into your LLM** (Claude, GPT-4, etc.)
3. **The LLM will follow the step-by-step instructions** to build the complete system
4. **Review and customize** the generated code for your specific needs
5. **Test thoroughly** before deploying to production

## Notes for LLMs

- Follow the steps sequentially
- Create all files as specified
- Use the exact directory structure provided
- Implement error handling and validation
- Add comments to explain complex logic
- Follow security best practices
- Test each component before moving to the next step

## Customization

You can customize this prompt by:

- Changing the CSS framework (add Tailwind, Bootstrap, etc.)
- Using different template engines (Liquid, Handlebars, etc.)
- Adding additional features (search, reviews, wishlists, etc.)
- Integrating different payment providers
- Using alternative authentication methods
- Connecting to different AI services

---

**Version:** 2.1.0
**Last Updated:** 2026-01-14
**Compatibility:** Eleventy 3.x, Node.js 20+, Shopify Theme API 2024-01
**Architecture:** Webflow Design Module → CI/CD → 11ty + Shopify Native
**Includes:** API Endpoint Schema Maps for Users, Products, UCP, Idempotency
</code></pre>

    </div>
  </main>
  
  <footer class="footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-left">
        <span class="footer-title">Webflow Integration Knowledge Base</span>
        <span class="footer-separator">·</span>
        <span>Built with 11ty</span>
      </div>
      <div class="footer-right">
        <span>Version 1.0</span>
        <span class="footer-separator">·</span>
        <span>2026</span>
      </div>
    </div>
  </div>
</footer>

  
  <script src="/js/main.js"></script>
</body>
</html>
