<h1>LLM Implementation Prompt: 11ty + Shopify UCP + Google AI Integration</h1>
<h2>Overview</h2>
<p>This document provides a complete, step-by-step implementation prompt for Large Language Models (Claude, GPT-4, etc.) to build an Eleventy (11ty) static site with Shopify Universal Commerce Protocol (UCP) integration, OAuth 2.0 authentication, A2P payment processing, and Google AI data streaming.</p>
<hr>
<h2>Prompt for LLM</h2>
<pre><code>You are tasked with building a complete e-commerce static site using Eleventy (11ty) that integrates with modern commerce protocols and AI services. Follow these instructions carefully to implement each component.

## PROJECT REQUIREMENTS

Build a static e-commerce site with the following features:

1. **Static Site Generation**: Use Eleventy (11ty) v3.x with Nunjucks templates
2. **Product Catalog**: Fetch products from Shopify's Universal Commerce Protocol (UCP) Catalog API
3. **User Authentication**: Implement OAuth 2.0 with PKCE for secure login
4. **Payment Processing**: Use Agent Payments Protocol (A2P) for cryptographic payment mandates
5. **Real-time Data**: Stream user behavior to Google AI via WebSocket
6. **Consent Management**: GDPR-compliant user consent tracking
7. **Responsive Design**: Mobile-first CSS with BEM methodology

## TECHNICAL STACK

- **Frontend**: Eleventy 11ty, Nunjucks, Vanilla JavaScript (ES6+), CSS3
- **APIs**: Shopify UCP Catalog REST API, OAuth 2.0, A2P Payment Gateway, Google AI Data Stream
- **Data Flow**: REST APIs, WebSocket, Server-Sent Events
- **Security**: JWT tokens, TLS 1.3, PKCE, PCI DSS compliance

## IMPLEMENTATION STEPS

### STEP 1: Initialize 11ty Project

Create a new 11ty project with the following structure:

</code></pre>
<p>project-root/
‚îú‚îÄ‚îÄ .eleventy.js           # 11ty configuration
‚îú‚îÄ‚îÄ package.json           # Dependencies
‚îú‚îÄ‚îÄ .env.example           # Environment variables template
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ _data/             # Data files for build-time fetching
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ucpClient.js   # UCP API client
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ products.js    # Product data fetcher
‚îÇ   ‚îú‚îÄ‚îÄ _includes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layouts/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ base.njk   # Base layout template
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ header.njk
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ footer.njk
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ product-card.njk
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.css       # Vanilla CSS with BEM
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js        # OAuth 2.0 client
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment.js     # A2P payment handler
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ websocket.js   # WebSocket client
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.js        # Main application logic
‚îÇ   ‚îú‚îÄ‚îÄ index.njk          # Homepage
‚îÇ   ‚îú‚îÄ‚îÄ products.njk       # Product listing page
‚îÇ   ‚îî‚îÄ‚îÄ checkout.njk       # Checkout page
‚îî‚îÄ‚îÄ _site/                 # Generated static site (output)</p>
<pre><code>
**package.json dependencies:**
```json
{
  &quot;name&quot;: &quot;11ty-ucp-integration&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;eleventy --serve&quot;,
    &quot;build&quot;: &quot;eleventy&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@11ty/eleventy&quot;: &quot;^3.0.0&quot;,
    &quot;node-fetch&quot;: &quot;^3.3.0&quot;,
    &quot;dotenv&quot;: &quot;^16.0.0&quot;
  }
}
</code></pre>
<p><strong>.eleventy.js configuration:</strong></p>
<pre><code class="language-javascript">module.exports = function(eleventyConfig) {
  // Copy static assets
  eleventyConfig.addPassthroughCopy(&quot;src/css&quot;);
  eleventyConfig.addPassthroughCopy(&quot;src/js&quot;);
  
  // Set directories
  return {
    dir: {
      input: &quot;src&quot;,
      output: &quot;_site&quot;,
      includes: &quot;_includes&quot;,
      data: &quot;_data&quot;
    }
  };
};
</code></pre>
<h3>STEP 2: Implement UCP Catalog Integration</h3>
<p>Create a client to fetch products from Shopify's UCP Catalog API at build time.</p>
<p><strong>src/_data/ucpClient.js:</strong></p>
<pre><code class="language-javascript">import fetch from 'node-fetch';

class UCPClient {
  constructor() {
    this.baseURL = process.env.UCP_CATALOG_API_URL;
    this.clientId = process.env.UCP_CLIENT_ID;
    this.clientSecret = process.env.UCP_CLIENT_SECRET;
    this.token = null;
  }

  async authenticate() {
    // Generate JWT token for API authentication
    const response = await fetch(`${this.baseURL}/auth/token`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        client_id: this.clientId,
        client_secret: this.clientSecret,
        grant_type: 'client_credentials'
      })
    });
    
    const data = await response.json();
    this.token = data.access_token;
  }

  async fetchProducts() {
    if (!this.token) await this.authenticate();
    
    const response = await fetch(`${this.baseURL}/catalog/products`, {
      headers: {
        'Authorization': `Bearer ${this.token}`,
        'Content-Type': 'application/json'
      }
    });
    
    return await response.json();
  }
}

module.exports = new UCPClient();
</code></pre>
<p><strong>src/_data/products.js:</strong></p>
<pre><code class="language-javascript">const ucpClient = require('./ucpClient');

module.exports = async function() {
  try {
    const data = await ucpClient.fetchProducts();
    return data.products || [];
  } catch (error) {
    console.error('Failed to fetch products:', error);
    return []; // Return empty array as fallback
  }
};
</code></pre>
<h3>STEP 3: Create Templates</h3>
<p><strong>src/_includes/layouts/base.njk:</strong></p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;title&gt;E-Commerce Store&lt;/title&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/main.css&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;header class=&quot;header&quot;&gt;
  &lt;div class=&quot;container&quot;&gt;
    &lt;div class=&quot;header-inner&quot;&gt;
      &lt;div class=&quot;header-left&quot;&gt;
        &lt;a href=&quot;/&quot; class=&quot;logo&quot;&gt;
          &lt;div class=&quot;logo-icon&quot;&gt;KB&lt;/div&gt;
          &lt;span class=&quot;logo-text&quot;&gt;Integration Docs&lt;/span&gt;
        &lt;/a&gt;
        
        &lt;nav class=&quot;nav-desktop&quot;&gt;
          &lt;a href=&quot;/&quot; class=&quot;nav-link &quot;&gt;
            &lt;span class=&quot;nav-icon&quot;&gt;üìñ&lt;/span&gt;
            Overview
          &lt;/a&gt;
          &lt;a href=&quot;/architecture/&quot; class=&quot;nav-link &quot;&gt;
            &lt;span class=&quot;nav-icon&quot;&gt;üèóÔ∏è&lt;/span&gt;
            Architecture
          &lt;/a&gt;
          &lt;a href=&quot;/implementation/&quot; class=&quot;nav-link &quot;&gt;
            &lt;span class=&quot;nav-icon&quot;&gt;üíª&lt;/span&gt;
            Implementation
          &lt;/a&gt;
          &lt;a href=&quot;/eleventy-graphql/&quot; class=&quot;nav-link &quot;&gt;
            &lt;span class=&quot;nav-icon&quot;&gt;üìÑ&lt;/span&gt;
            11ty GraphQL
          &lt;/a&gt;
          &lt;a href=&quot;/prd/&quot; class=&quot;nav-link &quot;&gt;
            &lt;span class=&quot;nav-icon&quot;&gt;üìã&lt;/span&gt;
            Claude PRD
          &lt;/a&gt;
          &lt;a href=&quot;/flow-chart/&quot; class=&quot;nav-link &quot;&gt;
            &lt;span class=&quot;nav-icon&quot;&gt;üìä&lt;/span&gt;
            Flow Charts
          &lt;/a&gt;
        &lt;/nav&gt;
      &lt;/div&gt;
      
      &lt;div class=&quot;header-right&quot;&gt;
        &lt;div class=&quot;search-container&quot;&gt;
          &lt;input type=&quot;text&quot; id=&quot;searchInput&quot; class=&quot;search-input&quot; placeholder=&quot;Search documentation...&quot;&gt;
          &lt;span class=&quot;search-icon&quot;&gt;üîç&lt;/span&gt;
        &lt;/div&gt;
        
        &lt;button class=&quot;mobile-menu-toggle&quot; id=&quot;mobileMenuToggle&quot;&gt;
          &lt;span class=&quot;hamburger&quot;&gt;&lt;/span&gt;
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;nav class=&quot;nav-mobile&quot; id=&quot;mobileNav&quot;&gt;
      &lt;a href=&quot;/&quot; class=&quot;nav-link-mobile&quot;&gt;
        &lt;span class=&quot;nav-icon&quot;&gt;üìñ&lt;/span&gt;
        Overview
      &lt;/a&gt;
      &lt;a href=&quot;/architecture/&quot; class=&quot;nav-link-mobile&quot;&gt;
        &lt;span class=&quot;nav-icon&quot;&gt;üèóÔ∏è&lt;/span&gt;
        Architecture
      &lt;/a&gt;
      &lt;a href=&quot;/implementation/&quot; class=&quot;nav-link-mobile&quot;&gt;
        &lt;span class=&quot;nav-icon&quot;&gt;üíª&lt;/span&gt;
        Implementation
      &lt;/a&gt;
      &lt;a href=&quot;/eleventy-graphql/&quot; class=&quot;nav-link-mobile&quot;&gt;
        &lt;span class=&quot;nav-icon&quot;&gt;üìÑ&lt;/span&gt;
        11ty GraphQL
      &lt;/a&gt;
      &lt;a href=&quot;/prd/&quot; class=&quot;nav-link-mobile&quot;&gt;
        &lt;span class=&quot;nav-icon&quot;&gt;üìã&lt;/span&gt;
        Claude PRD
      &lt;/a&gt;
      &lt;a href=&quot;/flow-chart/&quot; class=&quot;nav-link-mobile&quot;&gt;
        &lt;span class=&quot;nav-icon&quot;&gt;üìä&lt;/span&gt;
        Flow Charts
      &lt;/a&gt;
    &lt;/nav&gt;
  &lt;/div&gt;
&lt;/header&gt;

  
  &lt;main&gt;
    
  &lt;/main&gt;
  
  &lt;footer class=&quot;footer&quot;&gt;
  &lt;div class=&quot;container&quot;&gt;
    &lt;div class=&quot;footer-content&quot;&gt;
      &lt;div class=&quot;footer-left&quot;&gt;
        &lt;span class=&quot;footer-title&quot;&gt;Webflow Integration Knowledge Base&lt;/span&gt;
        &lt;span class=&quot;footer-separator&quot;&gt;¬∑&lt;/span&gt;
        &lt;span&gt;Built with 11ty&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&quot;footer-right&quot;&gt;
        &lt;span&gt;Version 1.0&lt;/span&gt;
        &lt;span class=&quot;footer-separator&quot;&gt;¬∑&lt;/span&gt;
        &lt;span&gt;2026&lt;/span&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/footer&gt;

  
  &lt;script src=&quot;/js/auth.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;/js/payment.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;/js/websocket.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;/js/main.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><strong>src/index.njk:</strong></p>
<pre><code class="language-html">---
layout: layouts/base.njk
title: &quot;Home - E-Commerce Store&quot;
---

&lt;section class=&quot;hero&quot;&gt;
  &lt;div class=&quot;container&quot;&gt;
    &lt;h1&gt;Welcome to Our Store&lt;/h1&gt;
    &lt;p&gt;Discover amazing products powered by Universal Commerce Protocol&lt;/p&gt;
  &lt;/div&gt;
&lt;/section&gt;

&lt;section class=&quot;products&quot;&gt;
  &lt;div class=&quot;container&quot;&gt;
    &lt;h2&gt;Featured Products&lt;/h2&gt;
    &lt;div class=&quot;product-grid&quot;&gt;
      
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/section&gt;
</code></pre>
<p><strong>src/_includes/components/product-card.njk:</strong></p>
<pre><code class="language-html">&lt;article class=&quot;product-card&quot;&gt;
  &lt;img src=&quot;&quot; alt=&quot;&quot; class=&quot;product-card__image&quot;&gt;
  &lt;div class=&quot;product-card__content&quot;&gt;
    &lt;h3 class=&quot;product-card__title&quot;&gt;&lt;/h3&gt;
    &lt;p class=&quot;product-card__description&quot;&gt;&lt;/p&gt;
    &lt;div class=&quot;product-card__footer&quot;&gt;
      &lt;span class=&quot;product-card__price&quot;&gt;$&lt;/span&gt;
      &lt;button class=&quot;btn btn--primary&quot; data-product-id=&quot;&quot;&gt;
        Add to Cart
      &lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/article&gt;
</code></pre>
<h3>STEP 4: Implement OAuth 2.0 Authentication</h3>
<p><strong>src/js/auth.js:</strong></p>
<pre><code class="language-javascript">class AuthManager {
  constructor() {
    this.authEndpoint = 'https://identity-provider.example.com/authorize';
    this.tokenEndpoint = 'https://identity-provider.example.com/token';
    this.clientId = 'your-client-id';
    this.redirectUri = window.location.origin + '/callback';
  }

  // Generate PKCE code verifier and challenge
  async generatePKCE() {
    const verifier = this.generateRandomString(128);
    const challenge = await this.sha256(verifier);
    return { verifier, challenge };
  }

  generateRandomString(length) {
    const array = new Uint8Array(length);
    crypto.getRandomValues(array);
    return Array.from(array, byte =&gt; byte.toString(16).padStart(2, '0')).join('');
  }

  async sha256(plain) {
    const encoder = new TextEncoder();
    const data = encoder.encode(plain);
    const hash = await crypto.subtle.digest('SHA-256', data);
    return btoa(String.fromCharCode(...new Uint8Array(hash)))
      .replace(/\+/g, '-')
      .replace(/\//g, '_')
      .replace(/=/g, '');
  }

  // Initiate OAuth 2.0 login flow
  async login() {
    const { verifier, challenge } = await this.generatePKCE();
    
    // Store verifier for later use
    sessionStorage.setItem('pkce_verifier', verifier);
    
    // Build authorization URL
    const params = new URLSearchParams({
      response_type: 'code',
      client_id: this.clientId,
      redirect_uri: this.redirectUri,
      scope: 'openid profile email',
      code_challenge: challenge,
      code_challenge_method: 'S256'
    });
    
    // Redirect to authorization endpoint
    window.location.href = `${this.authEndpoint}?${params.toString()}`;
  }

  // Handle OAuth callback
  async handleCallback() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    
    if (!code) {
      console.error('No authorization code received');
      return;
    }
    
    const verifier = sessionStorage.getItem('pkce_verifier');
    
    // Exchange code for tokens
    const response = await fetch(this.tokenEndpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({
        grant_type: 'authorization_code',
        code: code,
        redirect_uri: this.redirectUri,
        client_id: this.clientId,
        code_verifier: verifier
      })
    });
    
    const tokens = await response.json();
    
    // Store tokens securely
    this.storeTokens(tokens);
    
    // Clean up
    sessionStorage.removeItem('pkce_verifier');
    
    // Redirect to home
    window.location.href = '/';
  }

  storeTokens(tokens) {
    // In production, use httpOnly cookies via backend
    localStorage.setItem('access_token', tokens.access_token);
    localStorage.setItem('id_token', tokens.id_token);
    if (tokens.refresh_token) {
      localStorage.setItem('refresh_token', tokens.refresh_token);
    }
  }

  getAccessToken() {
    return localStorage.getItem('access_token');
  }

  isAuthenticated() {
    return !!this.getAccessToken();
  }

  logout() {
    localStorage.removeItem('access_token');
    localStorage.removeItem('id_token');
    localStorage.removeItem('refresh_token');
    window.location.href = '/';
  }
}

// Initialize auth manager
window.authManager = new AuthManager();

// Handle callback if on callback page
if (window.location.pathname === '/callback') {
  window.authManager.handleCallback();
}
</code></pre>
<h3>STEP 5: Implement A2P Payment Processing</h3>
<p><strong>src/js/payment.js:</strong></p>
<pre><code class="language-javascript">class PaymentManager {
  constructor() {
    this.paymentEndpoint = 'https://payment-gateway.example.com/mandate';
  }

  // Generate payment mandate
  async createMandate(orderData) {
    const mandate = {
      mandate_id: this.generateUUID(),
      amount: orderData.total,
      currency: 'USD',
      merchant_id: 'your-merchant-id',
      timestamp: new Date().toISOString(),
      nonce: this.generateRandomString(32),
      items: orderData.items
    };
    
    return mandate;
  }

  // Sign mandate with cryptographic signature
  async signMandate(mandate) {
    // In production, use Web Crypto API or backend signing
    const mandateString = JSON.stringify(mandate);
    const encoder = new TextEncoder();
    const data = encoder.encode(mandateString);
    
    // Generate signature (simplified - use proper crypto in production)
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const signature = btoa(String.fromCharCode(...new Uint8Array(hashBuffer)));
    
    return signature;
  }

  // Submit payment mandate
  async processPayment(orderData) {
    const mandate = await this.createMandate(orderData);
    const signature = await this.signMandate(mandate);
    
    const response = await fetch(this.paymentEndpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${window.authManager.getAccessToken()}`
      },
      body: JSON.stringify({
        mandate: mandate,
        signature: signature,
        public_key: 'your-public-key'
      })
    });
    
    if (!response.ok) {
      throw new Error('Payment processing failed');
    }
    
    return await response.json();
  }

  generateUUID() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      const r = Math.random() * 16 | 0;
      const v = c === 'x' ? r : (r &amp; 0x3 | 0x8);
      return v.toString(16);
    });
  }

  generateRandomString(length) {
    const array = new Uint8Array(length);
    crypto.getRandomValues(array);
    return Array.from(array, byte =&gt; byte.toString(16).padStart(2, '0')).join('');
  }
}

window.paymentManager = new PaymentManager();
</code></pre>
<h3>STEP 6: Implement WebSocket Data Streaming</h3>
<p><strong>src/js/websocket.js:</strong></p>
<pre><code class="language-javascript">class DataStreamManager {
  constructor() {
    this.wsEndpoint = 'wss://stream.example.com/data';
    this.ws = null;
    this.reconnectAttempts = 0;
    this.maxReconnectAttempts = 5;
  }

  // Connect to WebSocket server
  connect() {
    if (!this.hasUserConsent()) {
      console.log('User has not consented to data streaming');
      return;
    }
    
    const token = window.authManager.getAccessToken();
    this.ws = new WebSocket(`${this.wsEndpoint}?token=${token}`);
    
    this.ws.onopen = () =&gt; {
      console.log('WebSocket connected');
      this.reconnectAttempts = 0;
    };
    
    this.ws.onmessage = (event) =&gt; {
      const data = JSON.parse(event.data);
      this.handleMessage(data);
    };
    
    this.ws.onerror = (error) =&gt; {
      console.error('WebSocket error:', error);
    };
    
    this.ws.onclose = () =&gt; {
      console.log('WebSocket disconnected');
      this.reconnect();
    };
  }

  // Send event to Google AI
  sendEvent(eventType, eventData) {
    if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {
      console.warn('WebSocket not connected');
      return;
    }
    
    const event = {
      type: eventType,
      data: eventData,
      timestamp: new Date().toISOString(),
      user_id: this.getUserId()
    };
    
    this.ws.send(JSON.stringify(event));
  }

  // Handle incoming messages (AI recommendations)
  handleMessage(data) {
    if (data.type === 'recommendation') {
      this.displayRecommendations(data.products);
    } else if (data.type === 'personalization') {
      this.applyPersonalization(data.settings);
    }
  }

  // Reconnect logic
  reconnect() {
    if (this.reconnectAttempts &gt;= this.maxReconnectAttempts) {
      console.error('Max reconnection attempts reached');
      return;
    }
    
    this.reconnectAttempts++;
    const delay = Math.min(1000 * Math.pow(2, this.reconnectAttempts), 30000);
    
    setTimeout(() =&gt; {
      console.log(`Reconnecting... (attempt ${this.reconnectAttempts})`);
      this.connect();
    }, delay);
  }

  hasUserConsent() {
    return localStorage.getItem('data_streaming_consent') === 'true';
  }

  getUserId() {
    // Extract from ID token or session
    return 'user-id-placeholder';
  }

  displayRecommendations(products) {
    // Update UI with recommended products
    console.log('Received recommendations:', products);
  }

  applyPersonalization(settings) {
    // Apply personalization settings to UI
    console.log('Applying personalization:', settings);
  }

  disconnect() {
    if (this.ws) {
      this.ws.close();
    }
  }
}

window.dataStreamManager = new DataStreamManager();
</code></pre>
<h3>STEP 7: Implement Main Application Logic</h3>
<p><strong>src/js/main.js:</strong></p>
<pre><code class="language-javascript">// Initialize application
document.addEventListener('DOMContentLoaded', () =&gt; {
  initializeAuth();
  initializeCart();
  initializeDataStreaming();
  attachEventListeners();
});

function initializeAuth() {
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  
  if (window.authManager.isAuthenticated()) {
    loginBtn?.classList.add('hidden');
    logoutBtn?.classList.remove('hidden');
  } else {
    loginBtn?.classList.remove('hidden');
    logoutBtn?.classList.add('hidden');
  }
  
  loginBtn?.addEventListener('click', () =&gt; {
    window.authManager.login();
  });
  
  logoutBtn?.addEventListener('click', () =&gt; {
    window.authManager.logout();
  });
}

function initializeCart() {
  // Load cart from localStorage
  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  updateCartUI(cart);
}

function initializeDataStreaming() {
  if (window.authManager.isAuthenticated()) {
    window.dataStreamManager.connect();
    
    // Track page view
    window.dataStreamManager.sendEvent('pageview', {
      page: window.location.pathname,
      title: document.title
    });
  }
}

function attachEventListeners() {
  // Add to cart buttons
  document.querySelectorAll('[data-product-id]').forEach(button =&gt; {
    button.addEventListener('click', (e) =&gt; {
      const productId = e.target.dataset.productId;
      addToCart(productId);
      
      // Track event
      window.dataStreamManager.sendEvent('add_to_cart', {
        product_id: productId
      });
    });
  });
  
  // Checkout button
  const checkoutBtn = document.getElementById('checkoutBtn');
  checkoutBtn?.addEventListener('click', handleCheckout);
  
  // Consent toggle
  const consentToggle = document.getElementById('consentToggle');
  consentToggle?.addEventListener('change', (e) =&gt; {
    const consent = e.target.checked;
    localStorage.setItem('data_streaming_consent', consent);
    
    if (consent) {
      window.dataStreamManager.connect();
    } else {
      window.dataStreamManager.disconnect();
    }
  });
}

function addToCart(productId) {
  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  cart.push(productId);
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartUI(cart);
}

function updateCartUI(cart) {
  const cartCount = document.getElementById('cartCount');
  if (cartCount) {
    cartCount.textContent = cart.length;
  }
}

async function handleCheckout() {
  if (!window.authManager.isAuthenticated()) {
    alert('Please log in to checkout');
    window.authManager.login();
    return;
  }
  
  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  
  if (cart.length === 0) {
    alert('Your cart is empty');
    return;
  }
  
  try {
    // Calculate total and prepare order data
    const orderData = {
      items: cart,
      total: calculateTotal(cart)
    };
    
    // Process payment
    const result = await window.paymentManager.processPayment(orderData);
    
    if (result.status === 'success') {
      // Track purchase
      window.dataStreamManager.sendEvent('purchase', {
        transaction_id: result.transaction_id,
        total: orderData.total,
        items: cart
      });
      
      // Clear cart
      localStorage.setItem('cart', '[]');
      updateCartUI([]);
      
      // Show confirmation
      window.location.href = '/confirmation?id=' + result.transaction_id;
    }
  } catch (error) {
    console.error('Checkout failed:', error);
    alert('Payment processing failed. Please try again.');
  }
}

function calculateTotal(cart) {
  // Calculate total from cart items
  // In production, fetch current prices from API
  return cart.length * 99.99; // Placeholder
}
</code></pre>
<h3>STEP 8: Create CSS Styles</h3>
<p><strong>src/css/main.css:</strong></p>
<pre><code class="language-css">/* CSS Variables */
:root {
  --color-primary: #2563eb;
  --color-secondary: #64748b;
  --color-success: #10b981;
  --color-danger: #ef4444;
  --color-text: #1e293b;
  --color-bg: #ffffff;
  --color-border: #e2e8f0;
  --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --spacing-unit: 8px;
}

/* Reset */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: var(--font-sans);
  color: var(--color-text);
  background: var(--color-bg);
  line-height: 1.6;
}

/* Container */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 calc(var(--spacing-unit) * 2);
}

/* Hero Section */
.hero {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: calc(var(--spacing-unit) * 10) 0;
  text-align: center;
}

.hero h1 {
  font-size: 3rem;
  margin-bottom: calc(var(--spacing-unit) * 2);
}

/* Product Grid */
.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: calc(var(--spacing-unit) * 3);
  margin-top: calc(var(--spacing-unit) * 4);
}

/* Product Card (BEM) */
.product-card {
  background: white;
  border: 1px solid var(--color-border);
  border-radius: 8px;
  overflow: hidden;
  transition: transform 0.2s, box-shadow 0.2s;
}

.product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
}

.product-card__image {
  width: 100%;
  height: 200px;
  object-fit: cover;
}

.product-card__content {
  padding: calc(var(--spacing-unit) * 2);
}

.product-card__title {
  font-size: 1.25rem;
  margin-bottom: calc(var(--spacing-unit));
}

.product-card__description {
  color: var(--color-secondary);
  margin-bottom: calc(var(--spacing-unit) * 2);
}

.product-card__footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.product-card__price {
  font-size: 1.5rem;
  font-weight: bold;
  color: var(--color-primary);
}

/* Button */
.btn {
  padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 3);
  border: none;
  border-radius: 6px;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.2s;
}

.btn--primary {
  background: var(--color-primary);
  color: white;
}

.btn--primary:hover {
  background: #1d4ed8;
}

/* Utility */
.hidden {
  display: none;
}

/* Responsive */
@media (max-width: 768px) {
  .hero h1 {
    font-size: 2rem;
  }
  
  .product-grid {
    grid-template-columns: 1fr;
  }
}
</code></pre>
<h3>STEP 9: Environment Configuration</h3>
<p>Create <strong>.env.example:</strong></p>
<pre><code># Shopify UCP Catalog API
UCP_CATALOG_API_URL=https://catalog.shopify.com/api/v1
UCP_CLIENT_ID=your-client-id
UCP_CLIENT_SECRET=your-client-secret

# OAuth 2.0
OAUTH_AUTHORIZE_URL=https://identity-provider.example.com/authorize
OAUTH_TOKEN_URL=https://identity-provider.example.com/token
OAUTH_CLIENT_ID=your-oauth-client-id
OAUTH_REDIRECT_URI=http://localhost:8080/callback

# A2P Payment Gateway
PAYMENT_GATEWAY_URL=https://payment-gateway.example.com
PAYMENT_MERCHANT_ID=your-merchant-id

# Google AI Data Stream
GOOGLE_AI_STREAM_URL=wss://stream.google.com/data
GOOGLE_AI_API_KEY=your-api-key

# WebSocket Server
WEBSOCKET_SERVER_URL=wss://your-websocket-server.com
</code></pre>
<h3>STEP 10: Testing and Deployment</h3>
<ol>
<li>
<p><strong>Install dependencies:</strong></p>
<pre><code class="language-bash">npm install
</code></pre>
</li>
<li>
<p><strong>Configure environment:</strong></p>
<pre><code class="language-bash">cp .env.example .env
# Edit .env with your actual credentials
</code></pre>
</li>
<li>
<p><strong>Run development server:</strong></p>
<pre><code class="language-bash">npm start
</code></pre>
</li>
<li>
<p><strong>Build for production:</strong></p>
<pre><code class="language-bash">npm run build
</code></pre>
</li>
<li>
<p><strong>Deploy to CDN:</strong></p>
<ul>
<li>Upload <code>_site/</code> directory to your CDN or static hosting provider</li>
<li>Configure custom domain and SSL certificate</li>
<li>Set up environment variables in hosting platform</li>
</ul>
</li>
</ol>
<h2>SECURITY CHECKLIST</h2>
<ul>
<li>[ ] Use HTTPS/TLS 1.3 for all connections</li>
<li>[ ] Implement PKCE for OAuth 2.0</li>
<li>[ ] Store tokens in httpOnly cookies (not localStorage in production)</li>
<li>[ ] Validate all user inputs</li>
<li>[ ] Implement CSRF protection</li>
<li>[ ] Use Content Security Policy (CSP) headers</li>
<li>[ ] Implement rate limiting on API endpoints</li>
<li>[ ] Encrypt sensitive data at rest</li>
<li>[ ] Regular security audits and dependency updates</li>
<li>[ ] GDPR compliance for user data</li>
<li>[ ] PCI DSS compliance for payment processing</li>
</ul>
<h2>SUCCESS CRITERIA</h2>
<ul>
<li>[ ] Build completes in &lt; 30 seconds</li>
<li>[ ] Page load time &lt; 2 seconds (Lighthouse score &gt; 90)</li>
<li>[ ] All products display correctly from UCP API</li>
<li>[ ] OAuth 2.0 login flow works end-to-end</li>
<li>[ ] Payment processing succeeds with valid test cards</li>
<li>[ ] WebSocket connection remains stable</li>
<li>[ ] User consent properly tracked and respected</li>
<li>[ ] Mobile responsive design works on all devices</li>
<li>[ ] Cross-browser compatibility (Chrome, Firefox, Safari, Edge)</li>
<li>[ ] Accessibility score &gt; 90 (WCAG 2.1 AA compliant)</li>
</ul>
<h2>TROUBLESHOOTING</h2>
<p><strong>Build fails:</strong></p>
<ul>
<li>Check Node.js version (v18+ required)</li>
<li>Verify all dependencies installed</li>
<li>Check environment variables are set</li>
</ul>
<p><strong>Products not loading:</strong></p>
<ul>
<li>Verify UCP API credentials</li>
<li>Check API endpoint URL</li>
<li>Inspect network requests in browser DevTools</li>
</ul>
<p><strong>OAuth login fails:</strong></p>
<ul>
<li>Verify redirect URI matches configuration</li>
<li>Check PKCE implementation</li>
<li>Inspect authorization endpoint response</li>
</ul>
<p><strong>Payment processing fails:</strong></p>
<ul>
<li>Verify payment gateway credentials</li>
<li>Check mandate signature generation</li>
<li>Inspect payment endpoint response</li>
</ul>
<p><strong>WebSocket disconnects:</strong></p>
<ul>
<li>Check WebSocket server URL</li>
<li>Verify authentication token</li>
<li>Implement reconnection logic</li>
</ul>
<h2>NEXT STEPS</h2>
<p>After completing the basic implementation:</p>
<ol>
<li><strong>Add product search and filtering</strong></li>
<li><strong>Implement order history page</strong></li>
<li><strong>Add email notifications</strong></li>
<li><strong>Integrate analytics dashboard</strong></li>
<li><strong>Implement A/B testing</strong></li>
<li><strong>Add multi-language support</strong></li>
<li><strong>Optimize images and assets</strong></li>
<li><strong>Implement progressive web app (PWA) features</strong></li>
<li><strong>Add automated testing (unit, integration, e2e)</strong></li>
<li><strong>Set up CI/CD pipeline</strong></li>
</ol>
<h2>RESOURCES</h2>
<ul>
<li><a href="https://www.11ty.dev/docs/">Eleventy Documentation</a></li>
<li><a href="https://ucp.dev/">Shopify UCP Specification</a></li>
<li><a href="https://oauth.net/2/">OAuth 2.0 RFC</a></li>
<li><a href="https://ap2-protocol.org/">A2P Protocol Specification</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API">Web Crypto API</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket">WebSocket API</a></li>
</ul>
<hr>
<p><strong>END OF IMPLEMENTATION PROMPT</strong></p>
<pre><code>
---

## How to Use This Prompt

1. **Copy the entire prompt** (everything between the triple backticks in the &quot;Prompt for LLM&quot; section)
2. **Paste into your LLM** (Claude, GPT-4, etc.)
3. **The LLM will follow the step-by-step instructions** to build the complete system
4. **Review and customize** the generated code for your specific needs
5. **Test thoroughly** before deploying to production

## Notes for LLMs

- Follow the steps sequentially
- Create all files as specified
- Use the exact directory structure provided
- Implement error handling and validation
- Add comments to explain complex logic
- Follow security best practices
- Test each component before moving to the next step

## Customization

You can customize this prompt by:

- Changing the CSS framework (add Tailwind, Bootstrap, etc.)
- Using different template engines (Liquid, Handlebars, etc.)
- Adding additional features (search, reviews, wishlists, etc.)
- Integrating different payment providers
- Using alternative authentication methods
- Connecting to different AI services

---

**Version:** 1.0.0  
**Last Updated:** 2025-01-14  
**Compatibility:** Eleventy 3.x, Node.js 18+
</code></pre>
